<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converter cURL em JSON</title>
</head>
<body>
    <h1>Converter cURL em JSON</h1>

    <label for="curlInput">Insira um cURL:</label>
    <textarea id="curlInput" placeholder="Exemplo: curl --location --request GET '{{prdURL}}/concessionaires?cep=86000001' --data ''"></textarea>

    <button id="converterBotao">Converter</button>

    <div id="resultado" style="display: none;">
        <h2>Resultado:</h2>
        <textarea id="jsonResultado" readonly></textarea>
        <button id="copiarBotao">Copiar JSON</button>
    </div>

    <script>
        // Captura os elementos do DOM
        const curlInput = document.getElementById('curlInput');
        const converterBotao = document.getElementById('converterBotao');
        const resultado = document.getElementById('resultado');
        const jsonResultado = document.getElementById('jsonResultado');
        const copiarBotao = document.getElementById('copiarBotao');
        
        // Adiciona um ouvinte de evento para o clique no botão "Converter"
        converterBotao.addEventListener('click', function() {
            try {
                const curlString = curlInput.value;

                // Função para converter uma string cURL em um objeto JSON
                function curlToJson(curlString) {
    var jsonRequestStr = {};

    // Extrai o método HTTP
    var methodMatch = curlString.match(/--request (\w+)/);
    if (methodMatch) {
        jsonRequestStr.method = methodMatch[1];
    }

    // Extrai a URL
    var urlMatch = curlString.match(/'([^']+)'/);
    if (urlMatch) {
        jsonRequestStr.url = urlMatch[1];
    }

    // Extrai os cabeçalhos
    var headerMatches = curlString.match(/--header '([^']+)'/g);
    if (headerMatches) {
        listaDeStrings = headerMatches.map(function (headerMatch) {
            return headerMatch.match(/--header '([^']+)'/)[1];
        });
    }

    // Chama a função para transformar a lista em um objeto JSON
    
    
    if (typeof listaDeStrings !== 'undefined') {
        jsonRequestStr.headers = listaParaJson(listaDeStrings);
    }

    // Extrai o corpo da solicitação (payload)
    var dataMatch = curlString.match(/--data-raw '([^']+)'/);
    if (dataMatch) {
        jsonRequestStr.body = JSON.parse(dataMatch[1]);
    }

    return jsonRequestStr;
}

// Função para transformar uma lista em um objeto JSON
function listaParaJson(lista) {
    var jsonResult = {};

    for (var i = 0; i < lista.length; i++) {
        var parts = lista[i].split(': ');
        if (parts.length === 2) {
            var chave = parts[0];
            var valor = parts[1];
            jsonResult[chave] = valor;
        }
    }

    return jsonResult;
}

function generateGUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0,
            v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}

function criaJsonAcao(jsonRequestStr)
{
     jsonRequest = jsonRequestStr


     jsonAction = {
        action:{
           $id:"",
           $typeOfContent:"",
           type:"ProcessHttp",
           $title:"Requisição Do Curl",
           $invalid:false,
           settings:{
              headers:{},
              method:"",
              body:"",
              uri:"",
              responseStatusVariable:"status",
              responseBodyVariable:"response"
           },
           conditions:[
              
           ]
        },
        isCopyFromBlipActions:true
     }
jsonAction.action.$id = "via-script-" + generateGUID()
jsonAction.action.settings.headers = jsonRequest.headers
jsonAction.action.settings.method = jsonRequest.method
jsonAction.action.settings.body = JSON.stringify(jsonRequest.body)
jsonAction.action.settings.uri = jsonRequest.url

return JSON.stringify(jsonAction)

}

                // Chama a função para converter cURL em JSON
                const jsonRequestStr = curlToJson(curlString);
                const jsonBlockStr = criaJsonAcao(jsonRequestStr)

                // Exibe o resultado na página
                jsonResultado.value = jsonBlockStr;
                resultado.style.display = 'block';
            } catch (error) {
                alert('Erro ao converter cURL em JSON: ' + error.message);
            }
        });

        // Adiciona um ouvinte de evento para o clique no botão "Copiar JSON"
        copiarBotao.addEventListener('click', function() {
            jsonResultado.select();
            document.execCommand('copy');
            copiarBotao.textContent = 'JSON Copiado!';
        });
    </script>
</body>
</html>
