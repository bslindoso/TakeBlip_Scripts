{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e46361e2-38f5-4e9b-9ea8-7d7795f3712f","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"713f5ae5-024c-48ce-a665-476b11ff8d12","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"167px","left":"358.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d514b2b9-4f0c-421c-9f79-9fa54ff89dcc","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"377afe1e-202d-4223-9c32-b36c39c0b811","typeOfStateId":"state","$connId":"con_8","$id":"a2218525-d54a-4459-8b4e-2ad124f0ad8e","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"377afe1e-202d-4223-9c32-b36c39c0b811","typeOfStateId":"state","$connId":"con_13","$id":"1a305d89-8f67-4c09-b258-ea3746b7f5b2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7b4959fb-e9c8-486b-a26f-ada98fe26a42","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput, previousId) {\n    try {\n        typeInput = JSON.parse(typeInput).input\n        let idFormated = previousState.split(' ');\n        idFormated = idFormated[0].replace(/\\[/g,'').replace(/\\]/g,'').replace(/\\./g,'');\n        const exception = {\n            id: `${idFormated}`,\n            input: '{{input.content}}',\n            redirectMenu: `${typeInput}`,\n            blockId: previousId\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["state.previous.name","validInputJs","state.previous.id"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#FF961E","label":"executeScript","id":"blip-tag-10da33cd-3fdf-48d2-f8c7-275ffd02103c","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"122px","left":"877px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f961d4b1-ed0e-4055-8a4c-65a8c884cedb","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"959b012a-ccc6-442f-b9a0-28ea0ae1b8d8","typeOfStateId":"state","$connId":"con_18","$id":"4c701ca2-f14b-44c6-a2e2-8a66dc700445","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"returnException"}],"$invalid":false},{"stateId":"170c01f2-66b8-4172-8dfb-2a82ea6c65fc","typeOfStateId":"state","$connId":"con_23","$id":"547fe83f-0afb-43c2-916c-a7a82bca8415","conditions":[{"source":"context","comparison":"equals","values":["bot"],"variable":"tipoAtendimento"}],"$invalid":false},{"stateId":"3dfeb826-8b64-4698-a6bb-458787d92dcb","typeOfStateId":"state","$connId":"con_28","$id":"bb321922-2c69-4580-8c17-68ff93c4235c","conditions":[{"source":"context","comparison":"equals","values":["humano"],"variable":"tipoAtendimento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fdc1d3a5-3c54-4f20-936f-e3b3dd4d1ddd","$typeOfContent":"","type":"SetVariable","$title":"service","$invalid":false,"settings":{"variable":"service","value":"pesquisa"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false}],"id":"welcome","$title":"[REQUERIMENTS]","$position":{"top":"267px","left":"357.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff"}},"c9d0c48a-7d6b-468b-9458-41577eea43f7":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"42dad9e2-f098-4fa4-a5a2-550017b2a27e","typeOfStateId":"state","$connId":"con_33","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["N√£o"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"b38bb906-e911-42df-8c6e-8850af2f9076","typeOfStateId":"state","$connId":"con_38","$id":"303f5508-4559-41a4-91c3-816831033608","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n  let opt = ['Sim', 'N√£o']\n  let properties = {\n    'text': 'Voc√™ gostaria de deixar um coment√°rio sobre sua nota?',\n    'options': opt,\n    'values': opt,\n    'description': [],\n    'itens': [\n      { name: [opt[0], '1'] },\n      { name: [opt[1], '2'] }\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": true,\n      \"blipchatMenu\": false,\n      \"defaultText\": true,\n      \"defaultTextInverted\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exce√ß√£o no MENU\n  // if (hideInputText == 'true' || hideInputText == true) {\n  //   properties.text = sentenceOtherMistakesJs\n  // } else {\n  //   // Exibe mensagem de retorno\n  //   // if (returnJs == 'true' || returnJs == true) {\n  //   //   properties.text = 'Ol√°! Seja bem-vindo(a) novamente! üòÑ'\n  //   // }\n  // }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  // properties.itens = addItensNumeracao(properties.itens);\n\n  // Adi√ß√£o de op√ß√µes sem numera√ß√£o\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numera√ß√£o autom√°tica\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8bc5fc3c-432b-4f81-b06f-1261a57ba336","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"// {{resource.FunctionGetMenu}}\n\n// const run = (platform, menu) => {\n//   menu = JSON.parse(menu);\n//   platform = platform.toLowerCase();\n\n//   if (platform == 'instagram' || platform == 'messenger') {\n//     const objMenu = {\n//       'type': `text/plain`,\n//       'content' : geraMenuNumerico(menu)\n//     }\n//     return objMenu\n//   };\n\n//   let default_msg = {\n//     \"text\": menu.text,\n//     \"header\": 'Menu',\n//     \"body\": menu.text,\n//     \"footer\": '',\n//     \"button\": 'Menu',\n//     \"title\": 'Menu',\n//     \"namespaceTemplate\": '',\n//     \"nameTemplate\": '',\n//     \"options\": menu.options,\n//     \"values\": menu.values,\n//     \"submenu\": [],\n//     \"description\": menu.description,\n//     \"menuScope\": {\n//       ... menu.menuScope,\n//       \"platform\": platform\n//     },\n//   };\n\n//   var newMenu = getMenuForPlatform(default_msg);\n\n//   return newMenu;\n// };\n\n// function geraMenuNumerico(menu) {\n//   // menu = JSON.parse(menu);\n\n//   let listaOptions = '\\n\\n';\n//   for (let i = 0; i < menu.options.length; i++) {\n//     listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n//   }\n\n//   return menu.text + listaOptions;\n// }\n\n\n{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": '',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Marcas',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ...menu.menuScope,\n      \"platform\": platform\n    }\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8940abf0-026c-43a6-b327-285522bdc4b3","$typeOfContent":"","type":"TrackEvent","$title":"csat bot gostaria deixar comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat bot gostaria deixar comentario exibicao","action":"Exibicao"},"conditions":[]},{"$id":"32f56835-03f7-457c-a9fc-c8cf8a1e1c54","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + '{{n1}}' + (i + 1) + '.{{n2}} ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO NOTA';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"csat bot gostaria deixar comentario selecao","$invalid":false,"settings":{"extras":{},"category":"csat bot gostaria deixar comentario selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"csat bot gostaria deixar comentario inesperado","$invalid":false,"settings":{"extras":{},"category":"csat bot gostaria deixar comentario inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false}],"id":"c9d0c48a-7d6b-468b-9458-41577eea43f7","$title":"[P.0.0.5] [MENU] Deixar coment√°rio","$position":{"top":"537px","left":"564px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d207d526-bf88-4dab-acc4-733a83d163d4":{"$contentActions":[{"action":{"$id":"3aa84a5f-0709-4bb8-ab62-bb9a4a9d02ac","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"af03f14a-cfa5-4924-8fac-a29a76806e00","$typeOfContent":"text","type":"SendMessage","settings":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Obrigado! Conte um pouco sobre o porqu√™ da sua nota. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}","metadata":{}},"$cardContent":{"document":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Obrigado! Conte um pouco sobre o porqu√™ da sua nota. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f7041af0-d48e-4b95-a7cd-dcfffb7efaa1","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"42dad9e2-f098-4fa4-a5a2-550017b2a27e","typeOfStateId":"state","$connId":"con_43","$id":"3c56b049-518f-4193-a7a2-15d6820b224c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"67fea08f-968d-4c84-a5a0-128487517052","$typeOfContent":"","type":"TrackEvent","$title":"csat bot nota alta comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat bot nota alta comentario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"59dbda94-6e35-49c7-adca-d632283aa2e5","$typeOfContent":"","type":"SetVariable","$title":"motivo","$invalid":false,"settings":{"variable":"motivo","value":"{{input.content}}"},"conditions":[]},{"$id":"b72281fb-0eaf-46c1-8201-6445491fd3c0","$typeOfContent":"","type":"TrackEvent","$title":"csat bot nota alta comentario input","$invalid":false,"settings":{"extras":{},"category":"csat bot nota alta comentario input","action":"{{motivo}}"},"conditions":[]},{"$id":"e2657ba6-e251-45f3-ad61-1ebc0da83504","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat bot nota alta comentario","$invalid":false,"settings":{"extras":{},"category":"relatorio csat bot nota alta comentario","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}} | {{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-2664cb57-327e-f755-8a3a-fd0d71ef0745","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-75aa2141-c180-cddf-606b-031dca4c04f1","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false},{"background":"#0747A6","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"d207d526-bf88-4dab-acc4-733a83d163d4","root":false,"$title":"[P.0.0.6] Nota Alta","$position":{"top":"898px","left":"417px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"377afe1e-202d-4223-9c32-b36c39c0b811":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f4a76ec3-f892-4cad-ad43-60297c09eb7b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3fb7ef00-299c-4276-8405-acb5cf3a78a4","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Exce√ß√µes","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{resource.serviceList@excecao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-82243cbc-e3cc-2e9d-4799-05fe802b8731","canChangeBackground":false}],"id":"377afe1e-202d-4223-9c32-b36c39c0b811","$title":"[REDIRECT TO] Exce√ß√µes","$position":{"top":"122px","left":"1061px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"20f2a16a-1d69-47d1-9a24-d087fc0b331b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3ed14941-bd24-4013-a18d-1f4c6e4ace91","$typeOfContent":"","type":"SetVariable","$title":"clearException","$invalid":false,"settings":{"variable":"exception"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"ola"},"address":"{{resource.serviceList@finalizacao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-82243cbc-e3cc-2e9d-4799-05fe802b8731","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false}],"id":"20f2a16a-1d69-47d1-9a24-d087fc0b331b","root":false,"$title":"[REDIRECT TO] Finalizar","$position":{"top":"251.25px","left":"1061.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"79699b3e-9792-4285-afc5-b5aa42552260":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6d96947e-81eb-4195-9a03-8a7f8906e5eb","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7455ae48-cff1-4bbb-b8f7-34f0ecea3ba1","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Menu Principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Menu"},"address":"{{resource.serviceList@boas_vindas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-82243cbc-e3cc-2e9d-4799-05fe802b8731","canChangeBackground":false}],"id":"79699b3e-9792-4285-afc5-b5aa42552260","root":false,"$title":"[REDIRECT TO] Menu Principal","$position":{"top":"382.25px","left":"1061.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"959b012a-ccc6-442f-b9a0-28ea0ae1b8d8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aebf3f0a-56ac-4466-b042-70cabc54dbf4","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{exception@blockId}}","typeOfStateId":"variable","$id":"4b6359dc-f973-4cc3-b077-db85b0364d65","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ad440f48-87c3-4fa8-be77-43d1b0e5b835","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"false"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false}],"id":"959b012a-ccc6-442f-b9a0-28ea0ae1b8d8","root":false,"$title":"Retorno Exce√ß√£o","$position":{"top":"161px","left":"605px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#eb9694","textColor":"#000000","commentsIdList":[]}},"e573705c-3316-4d84-91a5-522df8c72b9b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c64af724-3e92-4164-bccc-d244039494c3","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5657d048-1dee-49e7-bf71-cd0e5993610f","$typeOfContent":"","type":"ProcessHttp","$title":"Disparo de Email","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}"},"method":"POST","body":"{\n   \"to\":\"b%40c.com@mailgun.gw.msging.net\",\n   \"type\":\"text/plain\",\n   \"content\":\"Cadastro de pessoa com defici√™ncia/limita√ß√£o registrado!\\n\\n Nome: {{nomeCompleto}} | CPF: {{cpf}} | Telefone: {{telefone}} | Email: {{email}} (opicional)\"\n}","uri":"https://http.msging.net/messages","responseStatusVariable":"statusEmail","responseBodyVariable":"responseEmail"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"e573705c-3316-4d84-91a5-522df8c72b9b","root":false,"$title":"Envio de Email","$position":{"top":"119px","left":"1321px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#f06292","textColor":"#000000","commentsIdList":[]}},"170c01f2-66b8-4172-8dfb-2a82ea6c65fc":{"$contentActions":[{"action":{"$id":"3ca20bf5-40b6-43ab-bdf0-1d594d0cbcb8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2c1de04e-6b5b-453d-b775-c507cf8118f6","type":"text/plain","content":"{{inputText}}","metadata":{}},"$cardContent":{"document":{"id":"2c1de04e-6b5b-453d-b775-c507cf8118f6","type":"text/plain","content":"{{inputText}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"42dad9e2-f098-4fa4-a5a2-550017b2a27e","typeOfStateId":"state","$connId":"con_48","$id":"57cb865a-effd-4482-8945-5496ab20a253","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"c9d0c48a-7d6b-468b-9458-41577eea43f7","typeOfStateId":"state","$connId":"con_53","$id":"205a5933-4cdb-4c28-8aa1-0b42cb8e3674","conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ee7f20f2-6581-44e1-99b3-dbb09af51957","$typeOfContent":"","type":"TrackEvent","$title":"csat bot exibicao","$invalid":false,"settings":{"extras":{},"category":"csat bot exibicao","action":"Exibicao"},"conditions":[]},{"$id":"93a648f3-3678-416d-ba61-3a39fe322fb7","$typeOfContent":"","type":"ExecuteScript","$title":"InputText","$invalid":false,"settings":{"function":"run","source":"function run(hide) {\n\n    let inputText = `Em uma escala de {{n1}}0 a 10{{n2}}, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para este canal?`\n\n    if (hide == true || hide == \"true\") {\n        return \"\";\n    } else  {\n        return inputText\n    }\n}","inputVariables":["hideInputText"],"outputVariable":"inputText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = false;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            nota: true\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6fcdec34-283c-4813-8fd1-a86c87718d5a","$typeOfContent":"","type":"SetVariable","$title":"score","$invalid":false,"settings":{"variable":"score","value":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"7834d7d6-0901-47a7-8f76-9e857ae74938","$typeOfContent":"","type":"TrackEvent","$title":"csat bot input","$invalid":false,"settings":{"extras":{},"category":"csat bot input","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"cfe5c70b-82e5-495a-8660-9a3a92d3890f","$typeOfContent":"","type":"TrackEvent","$title":"csat bot inesperado","$invalid":false,"settings":{"extras":{},"category":"csat bot inesperado","action":"{{input.content}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"12e86883-70f8-446a-b2a1-efa009a49315","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat bot nota","$invalid":false,"settings":{"extras":{},"category":"relatorio csat bot nota","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}}"},"conditions":[{"values":["success"],"source":"context","comparison":"equals","variable":"validInputJs@type"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-ed2ab0b6-d476-fa9f-0ed2-e09dd9fec033","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-4cffa4e2-3244-409f-90a7-9fff4b556eb1","canChangeBackground":false},{"background":"#2cc3d5","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"170c01f2-66b8-4172-8dfb-2a82ea6c65fc","$title":"[P.0.0.4] [INPUT] BOT","$position":{"top":"394px","left":"564px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"b38bb906-e911-42df-8c6e-8850af2f9076":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d207d526-bf88-4dab-acc4-733a83d163d4","typeOfStateId":"state","$connId":"con_58","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["7","8","9","10"],"variable":"score"}],"$invalid":false},{"stateId":"045224ca-61db-4d41-a9a6-bea8a1d157e4","typeOfStateId":"state","$connId":"con_63","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["3","2","1","6","5","4","0"],"variable":"score"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"b38bb906-e911-42df-8c6e-8850af2f9076","$title":"Valida Nota","$position":{"top":"688px","left":"561px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"addonsSettings":{"shape":"50% 0 50% 0","backgroundColor":"#ffb74d","textColor":"#000000"}},"42dad9e2-f098-4fa4-a5a2-550017b2a27e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"50ade096-7bd6-49d4-aae8-5ea2f6b2b7cc","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"20f2a16a-1d69-47d1-9a24-d087fc0b331b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#2cc3d5","label":"GO TO","id":"blip-tag-3396db14-221f-0677-0da0-49c28a8684ae","canChangeBackground":false}],"id":"42dad9e2-f098-4fa4-a5a2-550017b2a27e","root":false,"$title":"[GO TO] Finaliza√ß√£o BOT","$position":{"top":"1169px","left":"550px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"045224ca-61db-4d41-a9a6-bea8a1d157e4":{"$contentActions":[{"action":{"$id":"3aa84a5f-0709-4bb8-ab62-bb9a4a9d02ac","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"af03f14a-cfa5-4924-8fac-a29a76806e00","$typeOfContent":"text","type":"SendMessage","settings":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Sua opini√£o √© muito importante. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}","metadata":{}},"$cardContent":{"document":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Sua opini√£o √© muito importante. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f7041af0-d48e-4b95-a7cd-dcfffb7efaa1","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"42dad9e2-f098-4fa4-a5a2-550017b2a27e","typeOfStateId":"state","$connId":"con_68","$id":"3c56b049-518f-4193-a7a2-15d6820b224c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"67fea08f-968d-4c84-a5a0-128487517052","$typeOfContent":"","type":"TrackEvent","$title":"csat bot nota baixa comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat bot nota baixa comentario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"59dbda94-6e35-49c7-adca-d632283aa2e5","$typeOfContent":"","type":"SetVariable","$title":"motivo","$invalid":false,"settings":{"variable":"motivo","value":"{{input.content}}"},"conditions":[]},{"$id":"b72281fb-0eaf-46c1-8201-6445491fd3c0","$typeOfContent":"","type":"TrackEvent","$title":"csat bot nota baixa comentario input","$invalid":false,"settings":{"extras":{},"category":"csat bot nota baixa comentario input","action":"{{motivo}}"},"conditions":[]},{"$id":"e2657ba6-e251-45f3-ad61-1ebc0da83504","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat bot nota baixa comentario","$invalid":false,"settings":{"extras":{},"category":"relatorio csat bot nota baixa comentario","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}} | {{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-2664cb57-327e-f755-8a3a-fd0d71ef0745","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-75aa2141-c180-cddf-606b-031dca4c04f1","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false},{"background":"#0747A6","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"045224ca-61db-4d41-a9a6-bea8a1d157e4","root":false,"$title":"[P.0.0.7] Nota Baixa","$position":{"top":"900px","left":"710px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f74292df-fbb8-430a-8f1f-23277d7c71a7":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef","typeOfStateId":"state","$connId":"con_73","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["N√£o"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"fa25e3df-49f1-43ef-90fc-e001234cf250","typeOfStateId":"state","$connId":"con_78","$id":"303f5508-4559-41a4-91c3-816831033608","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n  let opt = ['Sim', 'N√£o']\n  let properties = {\n    'text': 'Voc√™ gostaria de deixar um coment√°rio sobre sua nota?',\n    'options': opt,\n    'values': opt,\n    'description': [],\n    'itens': [\n      { name: [opt[0], '1'] },\n      { name: [opt[1], '2'] }\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": true,\n      \"blipchatMenu\": false,\n      \"defaultText\": true,\n      \"defaultTextInverted\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // // Exibe mensagem e exce√ß√£o no MENU\n  // if (hideInputText == 'true' || hideInputText == true) {\n  //   properties.text = sentenceOtherMistakesJs\n  // } else {\n  //   // Exibe mensagem de retorno\n  //   // if (returnJs == 'true' || returnJs == true) {\n  //   //   properties.text = 'Ol√°! Seja bem-vindo(a) novamente! üòÑ'\n  //   // }\n  // }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  // properties.itens = addItensNumeracao(properties.itens);\n\n  // Adi√ß√£o de op√ß√µes sem numera√ß√£o\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numera√ß√£o autom√°tica\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8940abf0-026c-43a6-b327-285522bdc4b3","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento gostaria deixar comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat atendimento gostaria deixar comentario exibicao","action":"Exibicao"},"conditions":[]},{"$id":"eda67c22-4f4f-4dc6-b482-9110bcb665eb","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"// {{resource.FunctionGetMenu}}\n\n// const run = (platform, menu) => {\n//   menu = JSON.parse(menu);\n//   platform = platform.toLowerCase();\n\n//   if (platform == 'instagram' || platform == 'messenger') {\n//     const objMenu = {\n//       'type': `text/plain`,\n//       'content' : geraMenuNumerico(menu)\n//     }\n//     return objMenu\n//   };\n\n//   let default_msg = {\n//     \"text\": menu.text,\n//     \"header\": 'Menu',\n//     \"body\": menu.text,\n//     \"footer\": '',\n//     \"button\": 'Menu',\n//     \"title\": 'Menu',\n//     \"namespaceTemplate\": '',\n//     \"nameTemplate\": '',\n//     \"options\": menu.options,\n//     \"values\": menu.values,\n//     \"submenu\": [],\n//     \"description\": menu.description,\n//     \"menuScope\": {\n//       ... menu.menuScope,\n//       \"platform\": platform\n//     },\n//   };\n\n//   var newMenu = getMenuForPlatform(default_msg);\n\n//   return newMenu;\n// };\n\n// function geraMenuNumerico(menu) {\n//   // menu = JSON.parse(menu);\n\n//   let listaOptions = '\\n\\n';\n//   for (let i = 0; i < menu.options.length; i++) {\n//     listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n//   }\n\n//   return menu.text + listaOptions;\n// }\n\n\n{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": '',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Marcas',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ...menu.menuScope,\n      \"platform\": platform\n    }\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4180c7ba-5591-4cfc-ac3f-8ab981223c8f","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + '{{n1}}' + (i + 1) + '.{{n2}} ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO NOTA';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento gostaria deixar comentario selecao","$invalid":false,"settings":{"extras":{},"category":"csat atendimento gostaria deixar comentario selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento gostaria deixar comentario inesperado","$invalid":false,"settings":{"extras":{},"category":"csat atendimento gostaria deixar comentario inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false}],"id":"f74292df-fbb8-430a-8f1f-23277d7c71a7","$title":"[P.0.0.1] [MENU] Deixar coment√°rio","$position":{"top":"536px","left":"104px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"fa25e3df-49f1-43ef-90fc-e001234cf250":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b8591b38-56f2-4989-ad78-0f372e9b85db","typeOfStateId":"state","$connId":"con_83","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["7","8","9","10"],"variable":"score"}],"$invalid":false},{"stateId":"65b155b9-be2a-4f9b-85c3-4a8615bbb9c1","typeOfStateId":"state","$connId":"con_88","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["3","2","1","6","5","4","0"],"variable":"score"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"fa25e3df-49f1-43ef-90fc-e001234cf250","$title":"Valida Nota","$position":{"top":"705px","left":"98px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"addonsSettings":{"shape":"50% 0 50% 0","backgroundColor":"#ffb74d","textColor":"#000000","commentsIdList":[]}},"b8591b38-56f2-4989-ad78-0f372e9b85db":{"$contentActions":[{"action":{"$id":"3aa84a5f-0709-4bb8-ab62-bb9a4a9d02ac","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"af03f14a-cfa5-4924-8fac-a29a76806e00","$typeOfContent":"text","type":"SendMessage","settings":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Obrigado! Conte um pouco sobre o porqu√™ da sua nota. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}","metadata":{}},"$cardContent":{"document":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Obrigado! Conte um pouco sobre o porqu√™ da sua nota. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f7041af0-d48e-4b95-a7cd-dcfffb7efaa1","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef","typeOfStateId":"state","$connId":"con_93","$id":"3c56b049-518f-4193-a7a2-15d6820b224c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"67fea08f-968d-4c84-a5a0-128487517052","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento nota alta comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat atendimento nota alta comentario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"59dbda94-6e35-49c7-adca-d632283aa2e5","$typeOfContent":"","type":"SetVariable","$title":"motivo","$invalid":false,"settings":{"variable":"motivo","value":"{{input.content}}"},"conditions":[]},{"$id":"b72281fb-0eaf-46c1-8201-6445491fd3c0","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento nota alta comentario input","$invalid":false,"settings":{"extras":{},"category":"csat atendimento nota alta comentario input","action":"{{motivo}}"},"conditions":[]},{"$id":"e2657ba6-e251-45f3-ad61-1ebc0da83504","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat atendimento nota alta comentario","$invalid":false,"settings":{"extras":{},"category":"relatorio csat atendimento nota alta comentario","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}} | {{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-2664cb57-327e-f755-8a3a-fd0d71ef0745","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-75aa2141-c180-cddf-606b-031dca4c04f1","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false},{"background":"#0747A6","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"b8591b38-56f2-4989-ad78-0f372e9b85db","root":false,"$title":"[P.0.0.2] Nota Alta","$position":{"top":"897.75px","left":"0px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"65b155b9-be2a-4f9b-85c3-4a8615bbb9c1":{"$contentActions":[{"action":{"$id":"3aa84a5f-0709-4bb8-ab62-bb9a4a9d02ac","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"360fef91-7651-4fb9-97cb-4c0cccc3e238","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"af03f14a-cfa5-4924-8fac-a29a76806e00","$typeOfContent":"text","type":"SendMessage","settings":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Sua opini√£o √© muito importante. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}","metadata":{}},"$cardContent":{"document":{"id":"00f9b6d7-30f1-48cf-92ee-cddb8ac77ff5","type":"text/plain","content":"Sua opini√£o √© muito importante. ‚ò∫Ô∏è\n\nüí° {{n1}}Escreva tudo em uma √∫nica mensagem.{{n2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f7041af0-d48e-4b95-a7cd-dcfffb7efaa1","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef","typeOfStateId":"state","$connId":"con_98","$id":"3c56b049-518f-4193-a7a2-15d6820b224c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"67fea08f-968d-4c84-a5a0-128487517052","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento nota baixa comentario exibicao","$invalid":false,"settings":{"extras":{},"category":"csat atendimento nota baixa comentario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"59dbda94-6e35-49c7-adca-d632283aa2e5","$typeOfContent":"","type":"SetVariable","$title":"motivo","$invalid":false,"settings":{"variable":"motivo","value":"{{input.content}}"},"conditions":[]},{"$id":"b72281fb-0eaf-46c1-8201-6445491fd3c0","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento nota baixa comentario input","$invalid":false,"settings":{"extras":{},"category":"csat atendimento nota baixa comentario input","action":"{{motivo}}"},"conditions":[]},{"$id":"e2657ba6-e251-45f3-ad61-1ebc0da83504","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat atendimento nota baixa comentario","$invalid":false,"settings":{"extras":{},"category":"relatorio csat atendimento nota baixa comentario","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}} | {{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-2664cb57-327e-f755-8a3a-fd0d71ef0745","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-75aa2141-c180-cddf-606b-031dca4c04f1","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-024ed08b-c8b4-9452-aa33-a09569f77a2d","canChangeBackground":false},{"background":"#0747A6","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"65b155b9-be2a-4f9b-85c3-4a8615bbb9c1","root":false,"$title":"[P.0.0.3] Nota Baixa","$position":{"top":"897.5px","left":"215.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"50ade096-7bd6-49d4-aae8-5ea2f6b2b7cc","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"20f2a16a-1d69-47d1-9a24-d087fc0b331b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#2cc3d5","label":"GO TO","id":"blip-tag-3396db14-221f-0677-0da0-49c28a8684ae","canChangeBackground":false}],"id":"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef","root":false,"$title":"[GO TO] Finaliza√ß√£o HUMANO","$position":{"top":"1173px","left":"88.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"3dfeb826-8b64-4698-a6bb-458787d92dcb":{"$contentActions":[{"action":{"$id":"3ca20bf5-40b6-43ab-bdf0-1d594d0cbcb8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2c1de04e-6b5b-453d-b775-c507cf8118f6","type":"text/plain","content":"{{inputText}}","metadata":{}},"$cardContent":{"document":{"id":"2c1de04e-6b5b-453d-b775-c507cf8118f6","type":"text/plain","content":"{{inputText}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"d0bc1cd7-c00c-4e94-88c5-c1126abd89ef","typeOfStateId":"state","$connId":"con_103","$id":"cbb01b4d-83af-4545-8c82-852dde2c8b6b","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"f74292df-fbb8-430a-8f1f-23277d7c71a7","typeOfStateId":"state","$connId":"con_108","$id":"205a5933-4cdb-4c28-8aa1-0b42cb8e3674","conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ee7f20f2-6581-44e1-99b3-dbb09af51957","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento exibicao","$invalid":false,"settings":{"extras":{},"category":"csat atendimento exibicao","action":"Exibicao"},"conditions":[]},{"$id":"93a648f3-3678-416d-ba61-3a39fe322fb7","$typeOfContent":"","type":"ExecuteScript","$title":"InputText","$invalid":false,"settings":{"function":"run","source":"function run(hide) {\n\n    let inputText = `Em uma escala de {{n1}}0 a 10{{n2}}, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para esse atendimento?`\n\n    if (hide == true || hide == \"true\") {\n        return \"\";\n    } else  {\n        return inputText\n    }\n}","inputVariables":["hideInputText"],"outputVariable":"inputText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = false;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            nota: true\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6fcdec34-283c-4813-8fd1-a86c87718d5a","$typeOfContent":"","type":"SetVariable","$title":"score","$invalid":false,"settings":{"variable":"score","value":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"7834d7d6-0901-47a7-8f76-9e857ae74938","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento input","$invalid":false,"settings":{"extras":{},"category":"csat atendimento input","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"cfe5c70b-82e5-495a-8660-9a3a92d3890f","$typeOfContent":"","type":"TrackEvent","$title":"csat atendimento inesperado","$invalid":false,"settings":{"extras":{},"category":"csat atendimento inesperado","action":"{{input.content}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"12e86883-70f8-446a-b2a1-efa009a49315","$typeOfContent":"","type":"TrackEvent","$title":"relatorio csat atendimento nota","$invalid":false,"settings":{"extras":{},"category":"relatorio csat atendimento nota","action":"{{contact.name}} | {{contact.phoneNumber}} | {{entry_point}} | {{score}} | {{optMenuPrincipal}} | {{validaRegexMedidas}}"},"conditions":[{"values":["success"],"source":"context","comparison":"equals","variable":"validInputJs@type"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-ed2ab0b6-d476-fa9f-0ed2-e09dd9fec033","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-4cffa4e2-3244-409f-90a7-9fff4b556eb1","canChangeBackground":false},{"background":"#2cc3d5","label":"Relat√≥rio","id":"blip-tag-c4d6f5e4-dc2e-721b-d18b-86d9b360a612","canChangeBackground":false}],"id":"3dfeb826-8b64-4698-a6bb-458787d92dcb","$title":"[P.0.0.0] [INPUT] HUMANO","$position":{"top":"386px","left":"104.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"58f29e82-5d1a-4004-ad7e-85375996dbfc","$typeOfContent":"","type":"ExecuteScript","$title":"SET lastStateWithContent","$invalid":false,"settings":{"function":"run","source":"function run(stateName, stateId, previousStateName = null, previousStateId = null, service) {\n    return {\n        name: stateName,\n        id: stateId,\n        previousName: previousStateName,\n        previousId: previousStateId,\n        service: service\n    }\n}","inputVariables":["state.name","state.id","state.previous.name","state.previous.id","service"],"outputVariable":"lastStateWithContent"},"conditions":[{"$$hashKey":"object:1800","values":["[CONTENT]"],"source":"context","comparison":"contains","variable":"state.name"}]}],"$leavingCustomActions":[{"$id":"511f6f42-f362-420d-ad6b-57a74dfb3b0d","$typeOfContent":"","type":"ExecuteScript","$title":"SET lastStateWithInput","$invalid":false,"settings":{"function":"run","source":"function run(stateName, stateId, previousStateName = null, previousStateId = null, service) {\n    return {\n        name: stateName,\n        id: stateId,\n        previousName: previousStateName,\n        previousId: previousStateId,\n        service: service\n    }\n}","inputVariables":["state.name","state.id","state.previous.name","state.previous.id","service"],"outputVariable":"lastStateWithInput"},"conditions":[{"$$hashKey":"object:2445","values":["[INPUT]"],"source":"context","comparison":"contains","variable":"state.name"}]},{"$id":"5253157d-a985-4e40-b110-1e22d01d1df6","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}