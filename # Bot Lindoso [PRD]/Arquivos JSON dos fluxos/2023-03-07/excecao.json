{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"4ac90719-688a-42fa-8308-fbe1452ba381","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","typeOfStateId":"state","$connId":"con_3","$id":"e5559775-f7cb-4e69-af0e-5b176dd55f2a","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","typeOfStateId":"state","$connId":"con_8","$id":"b38c224e-b7d0-45b6-a030-ebef10cbf9eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c9be2de8-d656-4a9b-aa6b-4b7c2a4b2f53","$typeOfContent":"","type":"SetVariable","$title":"SET previousException","$invalid":false,"settings":{"variable":"previousException","value":"{{exception}}"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"previousException"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"129px","left":"227px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0adf1af9-611b-4df8-965b-ed9dc16a02dc","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1c4f6841-a1e2-419b-8145-23fb8d99101b","typeOfStateId":"state","$connId":"con_13","$id":"3f9cb29d-c318-4945-8275-d91660404291","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8ebfc765-beb5-4731-bf4d-103702b05a37","$typeOfContent":"","type":"SetVariable","$title":"service","$invalid":false,"settings":{"variable":"service","value":"excecao"},"conditions":[]},{"$id":"3fb9ae3a-8a2a-491d-a3da-c06854053da1","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput) {\n    try {\n        typeInput = JSON.parse(typeInput).input\n        let idFormated = previousState.split(' ');\n        idFormated = idFormated[0].replace(/\\[/g,'').replace(/\\]/g,'').replace(/\\./g,'');\n        const exception = {\n            id: `${idFormated}`,\n            input: '{{input.content}}',\n            redirectMenu: `${typeInput}`\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["state.previous.name","validInputJs"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","label":"SetVariable","background":"#b80000","canChangeBackground":false},{"id":"blip-tag-c4e1b16a-bd21-48ba-8e96-1d282c4bd636","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"133.5px","left":"799.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"400586b3-d77c-40ed-ba74-8aa107b25f0b":{"$contentActions":[{"action":{"$id":"659d10bd-84ad-467a-a07a-efa695f7ac90","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"dfc01f44-07f8-4622-9b81-9c9f5640c48f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dfc01f44-07f8-4622-9b81-9c9f5640c48f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5e7927f3-ac9f-4a17-81e7-d94ca94480f3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2da904c-8386-4900-b9ae-cc79c016e327","type":"text/plain","content":"{{messageErrorFormatJs}}","metadata":{}},"$cardContent":{"document":{"id":"f2da904c-8386-4900-b9ae-cc79c016e327","type":"text/plain","content":"{{messageErrorFormatJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"85121adb-6290-44f5-855c-0090b54eaaab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","typeOfStateId":"state","$connId":"con_18","$id":"45c6c023-eee4-474c-ba45-95a6dee077c5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"400586b3-d77c-40ed-ba74-8aa107b25f0b","root":false,"$title":"[X.1.1.0] Formatos não suportados","$position":{"top":"562px","left":"228px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54d99b2c-b338-4f12-a938-59ab815c9e4d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b55f6aa-8e8f-4f70-b27e-1d3c8cb1d71c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"02558330-d8fc-495d-88c7-5040869253bf","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"true"},"conditions":[]},{"$id":"a48eb7d5-7d47-4340-8248-b37c81533ded","$typeOfContent":"","type":"SetVariable","$title":"validApiJs [CLEAR]","$invalid":false,"settings":{"variable":"validApiJs"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f1a3443f-dc78-4994-9cef-d2220f970f42","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Bloco Anterior","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"54d99b2c-b338-4f12-a938-59ab815c9e4d","root":false,"$title":"[REDIRECT TO] Bloco Anterior","$position":{"top":"511.25px","left":"1004.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"ec24aa87-3496-4366-8bf1-43cdf503265a":{"$contentActions":[{"action":{"$id":"4c2cdace-3f07-48ad-899e-75af53b2d77a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"30dabcb6-5578-4480-83bd-a2fc560e5098","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"30dabcb6-5578-4480-83bd-a2fc560e5098","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9b49b95d-6813-4e8a-80a4-9b41e17d213d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e886a351-4239-4d25-9f89-c87f8634775e","type":"text/plain","content":"{{sentenceOtherMistakesJs}}","metadata":{}},"$cardContent":{"document":{"id":"e886a351-4239-4d25-9f89-c87f8634775e","type":"text/plain","content":"{{sentenceOtherMistakesJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8d823f9c-0e66-4767-9e2b-31c27c736154","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_23","$id":"56cb1961-fb3a-448c-ad81-3ae697a4a229","conditions":[{"source":"context","comparison":"equals","values":["ERRO API"],"variable":"exception@redirectMenu"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9e6c2f11-6533-4720-9255-01e1be734e84","$typeOfContent":"","type":"ExecuteScript","$title":"sentenceOtherMistakesJs","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    try {\n        let exceptionJs = JSON.parse(exception).redirectMenu\n\n        if (exceptionJs == 'ERRO DINAMICO') {\n            return `Não entendi o que você quis dizer...\\n\\nVamos tentar mais uma vez? Preciso que {{n1}}selecione{{n2}} uma das opções abaixo.`\n        }        \n        if (exceptionJs == 'ERRO NUMERICO') {\n            return `Não entendi...\\n\\nVamos tentar outra vez? Preciso que {{n1}}digite o número{{n2}} da opção que deseja.`\n        }\n        if (exceptionJs == 'ERRO NOTA') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO API') {\n            return ``\n        }\n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["exception"],"outputVariable":"sentenceOtherMistakesJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-a00bd978-b330-40ae-94aa-239aac41cf43","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"ec24aa87-3496-4366-8bf1-43cdf503265a","root":false,"$title":"[X.1.0.0] Erro Menu","$position":{"top":"449px","left":"228px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d0d3ba85-6e59-4915-8ff6-070c3d7b1376":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6d96947e-81eb-4195-9a03-8a7f8906e5eb","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7455ae48-cff1-4bbb-b8f7-34f0ecea3ba1","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Menu Principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Menu"},"address":"boasvindas"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"d0d3ba85-6e59-4915-8ff6-070c3d7b1376","root":false,"$title":"[REDIRECT TO] Menu Principal","$position":{"top":"254.5px","left":"1006.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"1c4f6841-a1e2-419b-8145-23fb8d99101b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f4a76ec3-f892-4cad-ad43-60297c09eb7b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3fb7ef00-299c-4276-8405-acb5cf3a78a4","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Exceções","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"1c4f6841-a1e2-419b-8145-23fb8d99101b","$title":"[REDIRECT TO] Exceções","$position":{"top":"123px","left":"1008px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"f4078b7c-fd36-47ec-a5d6-57e5392cddaa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d177afe0-1fc9-47f7-8d6d-a8888d6c114c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e5d6ae6-a400-4267-a294-9b22fc707da7","typeOfStateId":"state","$connId":"con_28","$id":"b5193d0c-b095-4c63-ac1e-c7f152a63d34","conditions":[{"source":"context","comparison":"contains","values":["true"],"variable":"inactivity"}],"$invalid":false},{"typeOfStateId":"state","$connId":"con_33","$id":"6a92a1c2-2268-4114-a92e-ee5f30f5a409","conditions":[{"source":"context","comparison":"greaterThan","values":["2"],"variable":"countError"}],"$invalid":false,"stateId":"e96a33b2-e693-4c01-9c0f-113ed3309f57"},{"stateId":"400586b3-d77c-40ed-ba74-8aa107b25f0b","typeOfStateId":"state","$connId":"con_38","$id":"f4d3a0c7-b477-401a-a188-e3e1d5e7fc82","conditions":[{"source":"context","comparison":"notEquals","values":["OUTRO ERRO"],"variable":"messageErrorFormatJs"}],"$invalid":false},{"stateId":"9d03752e-ab57-4b09-867c-a0123405f794","typeOfStateId":"state","$connId":"con_43","$id":"550bf6a9-b6d8-4600-a6b6-b064bc1f7fc2","conditions":[{"source":"context","comparison":"equals","values":["ERRO EMAIL","ERRO CPF","ERRO TELEFONE","ERRO NOME","ERRO DATA NASCIMENTO","ERRO CNH","ERRO CEP","ERRO ENDERECO","ERRO LOCALIZA ENDERECO","ERRO CIDADE","ERRO ESTADO"],"variable":"exception@redirectMenu"}],"$invalid":false},{"stateId":"ec24aa87-3496-4366-8bf1-43cdf503265a","typeOfStateId":"state","$connId":"con_48","$id":"ff0bb540-90f4-42dd-8368-93b37bf6ba79","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b2d94a35-4b59-4905-9ff7-293907050f92","$typeOfContent":"","type":"SetVariable","$title":"setCountError","$invalid":false,"settings":{"variable":"countError","value":"0"},"conditions":[{"source":"context","comparison":"notExists","variable":"countError","values":[]}]},{"$id":"05f551fa-6584-49bc-b7c6-d1a549106cec","$typeOfContent":"","type":"ExecuteScript","$title":"processCountError","$invalid":false,"settings":{"function":"run","source":"function run(countError, previousException, exception) {\n    try {\n        countError = Number(countError)\n        previousException = JSON.parse(previousException)\n        exception = JSON.parse(exception)\n\n        if(countError > 2){\n            return countError = 0\n        }\n        if (previousException.id == exception.id) {\n            return countError += 1\n        }\n\n        return countError = 1\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["countError","previousException","exception"],"outputVariable":"countError","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"883d49f3-7dbf-434a-9053-1082ad66801b","$typeOfContent":"","type":"ExecuteScript","$title":"processPreviousException","$invalid":false,"settings":{"function":"run","source":"function run(previousException, exception) {\n    try {\n        previousException = JSON.parse(previousException)\n        exception = JSON.parse(exception)\n\n        if (previousException.id != exception.id) {\n            return previousException = exception\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["previousException","exception"],"outputVariable":"previousException","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e1e32913-720e-46da-91bc-9572c948db8b","$typeOfContent":"","type":"ExecuteScript","$title":"inactivity","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    try {\n        exception = JSON.parse(exception)\n\n        if (exception.input == \"\") {\n            return true\n        }\n        return false\n    }\n    catch (e) {\n        return error\n    }\n}","inputVariables":["exception"],"outputVariable":"inactivity","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"19716dbd-22db-4bd5-85e6-a158605ab245","$typeOfContent":"","type":"ExecuteScript","$title":"messageErrorFormatJs","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    exception = JSON.parse(exception)\n    let inputType = exception.input\n\n    const regex = {\n        \"image\": /image/,\n        \"audio\": /audio/,\n        \"video\": /video/,\n        \"emoji\": /[\\u2600-\\u26ff]|[\\u2600-\\u27ff]|[\\u2700-\\u27bf]|\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]|\\ud83c[\\udf00-\\udfff]|\\ud83d[\\udc00-\\ude4f]|\\ud83d[\\ude80-\\udeff]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\udffb-\\udfff]/,\n        \"link\" : /^(((https?:\\/\\/)[^\\s.]+|(www))\\.[\\w][^\\s]+)$/,\n        \"arquivo\": /application|text\\/csv|text\\/html/,\n        \"figurinha\": /application\\/octet-stream|image\\/webp/\n    }\n\n\n    if(inputType.match(regex.image)){\n        return \"Por enquanto não sei processar imagens. Entendo apenas texto. ☹️\"\n    }\n\n    if(inputType.match(regex.audio)){\n        return \"Ainda não consigo entender arquivos de áudio, mas podemos conversar por texto. ☹️\"\n    }\n\n    if(inputType.match(regex.video)){\n        return \"Por enquanto não consigo assistir vídeos 🎥, mas você pode conversar comigo por texto. ☹️\"\n    }\n\n    if(inputType.match(regex.emoji) || inputType.match(regex.figurinha)){\n        return \"Por enquanto eu não sei ler emojis ou figurinhas. Só mensagens de texto. ☹️\"\n    }\n      \n    if(inputType.match(regex.link)){\n        return \"Ainda não sei acessar nenhum link 🌐, mas você pode conversar comigo por texto. ☹️\"\n    }\n\n    if(inputType.match(regex.arquivo)){\n        return \"Eu ainda não entendo este tipo de conteúdo 📄. Só consigo ler mensagens de texto. ☹️\"\n    }\n\n    return \"OUTRO ERRO\"\n}\n","inputVariables":["exception"],"outputVariable":"messageErrorFormatJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-d7ac0013-2e45-4410-98b7-9d522e17192b","label":"SetVariable","background":"#b80000","canChangeBackground":false},{"id":"blip-tag-8bd09876-c866-4979-adef-faa3753cb406","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","root":false,"$title":"[REQUIREMENTS]","$position":{"top":"226px","left":"225px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff"}},"e4484b9f-a98a-4544-8a8a-1138c84599a5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3ed14941-bd24-4013-a18d-1f4c6e4ace91","$typeOfContent":"","type":"SetVariable","$title":"clearException","$invalid":false,"settings":{"variable":"exception"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"ola"},"address":"finalizacao"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false},{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"e4484b9f-a98a-4544-8a8a-1138c84599a5","root":false,"$title":"[REDIRECT TO] Finalizar","$position":{"top":"383px","left":"1005.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"9d03752e-ab57-4b09-867c-a0123405f794":{"$contentActions":[{"action":{"$id":"3603a4ad-a386-4ce4-961e-4c27d12ddd84","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e7f81448-4fc5-449f-86a4-201bfa0f0c11","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e7f81448-4fc5-449f-86a4-201bfa0f0c11","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33dedaf4-60d1-47c8-b756-26a38f4812f4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"79a882fb-0676-4697-b48d-7cdeae7a014f","type":"text/plain","content":"{{phraseErrorWithInputJs}}","metadata":{}},"$cardContent":{"document":{"id":"79a882fb-0676-4697-b48d-7cdeae7a014f","type":"text/plain","content":"{{phraseErrorWithInputJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1472e4b5-0834-4fab-ac3d-1f24e24d44a9","type":"text/plain","textContent":"User input","content":"name"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"name"},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a086fa26-3b26-4e34-a3a6-1284f6e800a6","$typeOfContent":"","type":"ExecuteScript","$title":"phraseErrorWithInputJs","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    try {\n        let exceptionJs = JSON.parse(exception).redirectMenu\n\n        if (exceptionJs == 'ERRO CPF') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO EMAIL') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO TELEFONE') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO DATA NASCIMENTO') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO CNH') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO CEP') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO NOME') {\n            return `Por favor, digite somente texto.`\n        }\n        if (exceptionJs == 'ERRO ENDERECO') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO LOCALIZA ENDERECO') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO CIDADE') {\n            return ``\n        }\n        if (exceptionJs == 'ERRO ESTADO') {\n            return ``\n        }\n        \n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["exception"],"outputVariable":"phraseErrorWithInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3dc55ca2-7883-4f2c-b1f0-92539212357a","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false] (default TRUE)","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-68d0da90-ee55-427f-b191-c23f165f3b2e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false}],"id":"9d03752e-ab57-4b09-867c-a0123405f794","root":false,"$title":"[X.22.0.0] Erro Input","$position":{"top":"336px","left":"228px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e5d6ae6-a400-4267-a294-9b22fc707da7":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a3a4600e-23a7-40fc-a95f-280abaa0a17d","typeOfStateId":"state","$connId":"con_53","$id":"c30560be-2a56-408c-b3fc-0407bc5ea2d5","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","typeOfStateId":"state","$connId":"con_58","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_63","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"d0d3ba85-6e59-4915-8ff6-070c3d7b1376","typeOfStateId":"state","$connId":"con_68","$id":"4c886f3f-38e7-448f-8e3a-221d3d3d7dca","conditions":[{"source":"context","comparison":"equals","values":["Menu"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_73","$id":"577bc8f7-593f-454d-994b-b5c56e6d7605","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  let properties = {\n    'text': `Hmm... notei que parou de responder... 🤔\\nDeseja continuar com o nosso atendimento?`,\n    'options': [\"Sim\", \"Não\"],\n    'values': [\"Sim\", \"Não\"],\n    'description': [],\n    'itens': [\n      { name: ['Sim'] },\n      { name: ['Não'] }\n    ]\n  }\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = [\n    { name: ['Menu', 'Voltar ao início', 'Reiniciar'] },\n    { name: ['Sair', 'Finalizar', 'Encerrar'] }\n  ]\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":[],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false,\n      \"platform\": convertPlatform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18db78c0-fa11-4575-866e-6f13d900f271","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"intatividade exibicao","$invalid":false,"settings":{"extras":{},"category":"intatividade exibicao","action":"Exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'SAIR'\n            return JSON.stringify(processedInput)\n        } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'MENU'\n            return JSON.stringify(processedInput)\n        }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs"},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"intatividade selecao","$invalid":false,"settings":{"extras":{},"category":"intatividade selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"intatividade Input inesperado","$invalid":false,"settings":{"extras":{},"category":"intatividade Input inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#ffe500","label":"UserInput","id":"blip-tag-dbc9a043-f12b-4db2-98bd-6b11c3074486","canChangeBackground":false}],"id":"0e5d6ae6-a400-4267-a294-9b22fc707da7","$title":"[I.1.0.0] [MENU] - Inatividade 60 min","$position":{"top":"678.857px","left":"226.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff"}},"e96a33b2-e693-4c01-9c0f-113ed3309f57":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","typeOfStateId":"state","$connId":"con_78","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["Tentar novamente"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"3c64385e-253b-43d0-9316-aabd7c5e15cb","typeOfStateId":"state","$connId":"con_83","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Falar com atendente"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"d0d3ba85-6e59-4915-8ff6-070c3d7b1376","typeOfStateId":"state","$connId":"con_88","$id":"4c886f3f-38e7-448f-8e3a-221d3d3d7dca","conditions":[{"source":"context","comparison":"equals","values":["Menu"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_93","$id":"577bc8f7-593f-454d-994b-b5c56e6d7605","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  let properties = {\n    'text': `Sinto muito, não entendi...☹️ Escolha uma das opções:`,\n    'options': [\"Tentar novamente\", \"Falar com atendente\"],\n    'values': [\"Tentar novamente\", \"Falar com atendente\"],\n    'description': [],\n    'itens': [\n      { name: ['Tentar novamente'] },\n      { name: ['Falar com atendente'] }\n    ]\n  }\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = [\n    { name: ['Menu', 'Voltar ao início', 'Reiniciar'] },\n    { name: ['Sair', 'Finalizar', 'Encerrar'] }\n  ]\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":[],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false,\n      \"platform\": convertPlatform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18db78c0-fa11-4575-866e-6f13d900f271","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'SAIR'\n            return JSON.stringify(processedInput)\n        } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'MENU'\n            return JSON.stringify(processedInput)\n        }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false}],"id":"e96a33b2-e693-4c01-9c0f-113ed3309f57","$title":"[X.2.0.0] [MENU] - Erro Persistente","$position":{"top":"216.857px","left":"436.429px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff"}},"3c64385e-253b-43d0-9316-aabd7c5e15cb":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3ed14941-bd24-4013-a18d-1f4c6e4ace91","$typeOfContent":"","type":"SetVariable","$title":"clearException","$invalid":false,"settings":{"variable":"exception"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Transbordo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"ola"},"address":"transbordo"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false},{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"3c64385e-253b-43d0-9316-aabd7c5e15cb","root":false,"$title":"[REDIRECT TO] Transbordo","$position":{"top":"646px","left":"1003.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"a3a4600e-23a7-40fc-a95f-280abaa0a17d":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_98","$id":"c30560be-2a56-408c-b3fc-0407bc5ea2d5","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","typeOfStateId":"state","$connId":"con_103","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["Continuar","Sim"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_108","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Pode encerrar","Não"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"d0d3ba85-6e59-4915-8ff6-070c3d7b1376","typeOfStateId":"state","$connId":"con_113","$id":"4c886f3f-38e7-448f-8e3a-221d3d3d7dca","conditions":[{"source":"context","comparison":"equals","values":["Menu"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_118","$id":"577bc8f7-593f-454d-994b-b5c56e6d7605","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  let properties = {\n    'text': `Ainda não recebi sua resposta... 😕\\n\\nPor esse motivo, terei que encerrar o atendimento por falta de interação.\\n\\n{{n1}}Deseja continuar?{{n2}}`,\n    'options': [\"Continuar\", \"Pode encerrar\"],\n    'values': [\"Continuar\", \"Pode encerrar\"],\n    'description': [],\n    'itens': [\n      { name: ['Continuar', 'Sim', 'Claro', 'Ok'] },\n      { name: ['Pode encerrar', 'Não'] }\n    ]\n  }\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = [\n    { name: ['Menu', 'Voltar ao início', 'Reiniciar'] },\n    { name: ['Sair', 'Finalizar', 'Encerrar'] }\n  ]\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":[],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false,\n      \"platform\": convertPlatform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18db78c0-fa11-4575-866e-6f13d900f271","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"intatividade exibicao","$invalid":false,"settings":{"extras":{},"category":"intatividade exibicao","action":"Exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'SAIR'\n            return JSON.stringify(processedInput)\n        } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'MENU'\n            return JSON.stringify(processedInput)\n        }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs"},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"intatividade selecao","$invalid":false,"settings":{"extras":{},"category":"intatividade selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"intatividade Input inesperado","$invalid":false,"settings":{"extras":{},"category":"intatividade Input inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#ffe500","label":"UserInput","id":"blip-tag-dbc9a043-f12b-4db2-98bd-6b11c3074486","canChangeBackground":false}],"id":"a3a4600e-23a7-40fc-a95f-280abaa0a17d","$title":"[I.1.0.0] [MENU] - Inatividade 30 min","$position":{"top":"815px","left":"226.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff","commentsIdList":[]}}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}