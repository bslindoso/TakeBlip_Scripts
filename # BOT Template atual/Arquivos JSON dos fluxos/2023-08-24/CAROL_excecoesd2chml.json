{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"4ac90719-688a-42fa-8308-fbe1452ba381","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","typeOfStateId":"state","$connId":"con_3","$id":"e5559775-f7cb-4e69-af0e-5b176dd55f2a","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","typeOfStateId":"state","$connId":"con_8","$id":"b38c224e-b7d0-45b6-a030-ebef10cbf9eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c9be2de8-d656-4a9b-aa6b-4b7c2a4b2f53","$typeOfContent":"","type":"SetVariable","$title":"SET previousException","$invalid":false,"settings":{"variable":"previousException","value":"{{exception}}"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"previousException"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"onboarding","root":true,"$title":"In√≠cio","$position":{"top":"106px","left":"225px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0adf1af9-611b-4df8-965b-ed9dc16a02dc","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1c4f6841-a1e2-419b-8145-23fb8d99101b","typeOfStateId":"state","$connId":"con_13","$id":"6790025e-b3eb-4d39-9f15-27b753c8de1c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5b6442f0-4643-453e-9872-bbdc677005d8","$typeOfContent":"","type":"SetVariable","$title":"service","$invalid":false,"settings":{"variable":"service","value":"excecoes"},"conditions":[]},{"$id":"3fb9ae3a-8a2a-491d-a3da-c06854053da1","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput, previousId) {\n    try {\n        typeInput = JSON.parse(typeInput).input\n        let idFormated = previousState.split(' ');\n        idFormated = idFormated[0].replace(/\\[/g,'').replace(/\\]/g,'').replace(/\\./g,'');\n        const exception = {\n            id: `${idFormated}`,\n            input: `{{input.content}}`,\n            redirectMenu: `${typeInput}`,\n            blockId: previousId\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["state.previous.name","validInputJs","state.previous.id"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","label":"SetVariable","background":"#b80000","canChangeBackground":false},{"id":"blip-tag-c4e1b16a-bd21-48ba-8e96-1d282c4bd636","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exce√ß√µes","$position":{"top":"108.75px","left":"825.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"400586b3-d77c-40ed-ba74-8aa107b25f0b":{"$contentActions":[{"action":{"$id":"659d10bd-84ad-467a-a07a-efa695f7ac90","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"dfc01f44-07f8-4622-9b81-9c9f5640c48f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dfc01f44-07f8-4622-9b81-9c9f5640c48f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5e7927f3-ac9f-4a17-81e7-d94ca94480f3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2da904c-8386-4900-b9ae-cc79c016e327","type":"text/plain","content":"{{messageErrorFormatJs}}","metadata":{}},"$cardContent":{"document":{"id":"f2da904c-8386-4900-b9ae-cc79c016e327","type":"text/plain","content":"{{messageErrorFormatJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"85121adb-6290-44f5-855c-0090b54eaaab","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"423a0ba0-d335-49a2-945d-07e0b64f2c63","$typeOfContent":"","type":"TrackEvent","$title":"erro formato exibicao","$invalid":false,"settings":{"extras":{},"category":"erro formato exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false}],"id":"400586b3-d77c-40ed-ba74-8aa107b25f0b","root":false,"$title":"[FN.1.0.0] Formatos n√£o suportados","$position":{"top":"592px","left":"228px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54d99b2c-b338-4f12-a938-59ab815c9e4d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b55f6aa-8e8f-4f70-b27e-1d3c8cb1d71c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"02558330-d8fc-495d-88c7-5040869253bf","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"true"},"conditions":[]},{"$id":"a48eb7d5-7d47-4340-8248-b37c81533ded","$typeOfContent":"","type":"SetVariable","$title":"validApiJs [CLEAR]","$invalid":false,"settings":{"variable":"validApiJs"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f1a3443f-dc78-4994-9cef-d2220f970f42","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Bloco Anterior","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"54d99b2c-b338-4f12-a938-59ab815c9e4d","root":false,"$title":"[REDIRECT TO] Bloco Anterior","$position":{"top":"500px","left":"1018px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"ec24aa87-3496-4366-8bf1-43cdf503265a":{"$contentActions":[{"action":{"$id":"4c2cdace-3f07-48ad-899e-75af53b2d77a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"30dabcb6-5578-4480-83bd-a2fc560e5098","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"30dabcb6-5578-4480-83bd-a2fc560e5098","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3611"},{"action":{"$id":"9b49b95d-6813-4e8a-80a4-9b41e17d213d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e886a351-4239-4d25-9f89-c87f8634775e","type":"text/plain","content":"{{sentenceOtherMistakesJs}}","metadata":{}},"$cardContent":{"document":{"id":"e886a351-4239-4d25-9f89-c87f8634775e","type":"text/plain","content":"{{sentenceOtherMistakesJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3612"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8d823f9c-0e66-4767-9e2b-31c27c736154","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3613"}],"$conditionOutputs":[{"stateId":"0e5d6ae6-a400-4267-a294-9b22fc707da7","typeOfStateId":"state","$connId":"con_18","$id":"346bc23a-7ced-4838-9160-77ff68df7d61","conditions":[{"source":"context","comparison":"equals","values":["0e5d6ae6-a400-4267-a294-9b22fc707da7"],"variable":"exception@blockId","$$hashKey":"object:3630"}],"$invalid":false,"$$hashKey":"object:3619"}],"$enteringCustomActions":[{"$id":"9e6c2f11-6533-4720-9255-01e1be734e84","$typeOfContent":"","type":"ExecuteScript","$title":"sentenceOtherMistakesJs","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    try {\n        let exceptionJs = JSON.parse(exception).redirectMenu\n\n        if (exceptionJs == 'ERRO DINAMICO') {\n            return `Desculpe, n√£o consegui entender qual op√ß√£o voc√™ selecionou. ‚úñÔ∏è\\n\\n{{n1}}Selecione uma das op√ß√µes a seguir. üëá{{n2}}`\n        }\n        if (exceptionJs == 'ERRO NUM√âRICO') {\n            return `Desculpe, n√£o consegui entender o n√∫mero que voc√™ digitou. ‚úñÔ∏è\\n\\n{{n1}}Digite um dos n√∫meros ou clique no(s) bot√£o(√µes) a seguir. üëá{{n2}}`\n        }\n        if (exceptionJs == 'ERRO API') {\n            return `Desculpe, estamos passando por um problema em nosso sistema. ‚úñÔ∏è\\n\\n{{n1}}üí° Aguarde por alguns minutos e tente novamente...{{n2}}`\n        }\n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["exception"],"outputVariable":"sentenceOtherMistakesJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a464d879-bd94-4147-9d43-7974659a6b6f","$typeOfContent":"","type":"TrackEvent","$title":"erro menu exibicao","$invalid":false,"settings":{"extras":{},"category":"erro menu exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-a00bd978-b330-40ae-94aa-239aac41cf43","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false}],"id":"ec24aa87-3496-4366-8bf1-43cdf503265a","root":false,"$title":"[X.1.0.0] Erro Menu","$position":{"top":"453px","left":"227px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1c4f6841-a1e2-419b-8145-23fb8d99101b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f4a76ec3-f892-4cad-ad43-60297c09eb7b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3fb7ef00-299c-4276-8405-acb5cf3a78a4","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Exce√ß√µes","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"1c4f6841-a1e2-419b-8145-23fb8d99101b","$title":"[REDIRECT TO] Exce√ß√µes","$position":{"top":"109px","left":"1017px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"f4078b7c-fd36-47ec-a5d6-57e5392cddaa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d177afe0-1fc9-47f7-8d6d-a8888d6c114c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4382"}],"$conditionOutputs":[{"stateId":"0e5d6ae6-a400-4267-a294-9b22fc707da7","typeOfStateId":"state","$connId":"con_23","$id":"b5193d0c-b095-4c63-ac1e-c7f152a63d34","conditions":[{"source":"context","comparison":"contains","values":["true"],"variable":"inactivity","$$hashKey":"object:4407"}],"$invalid":false,"$$hashKey":"object:4384"},{"typeOfStateId":"state","$connId":"con_28","$id":"6a92a1c2-2268-4114-a92e-ee5f30f5a409","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"countError","$$hashKey":"object:4423"}],"$invalid":false,"stateId":"a680148c-4492-4f88-a562-58c33c6c4271","$$hashKey":"object:4385"},{"stateId":"400586b3-d77c-40ed-ba74-8aa107b25f0b","typeOfStateId":"state","$connId":"con_33","$id":"f4d3a0c7-b477-401a-a188-e3e1d5e7fc82","conditions":[{"source":"context","comparison":"notEquals","values":["OUTRO ERRO"],"variable":"messageErrorFormatJs","$$hashKey":"object:4439"}],"$invalid":false,"$$hashKey":"object:4386"},{"stateId":"9d03752e-ab57-4b09-867c-a0123405f794","typeOfStateId":"state","$connId":"con_38","$id":"550bf6a9-b6d8-4600-a6b6-b064bc1f7fc2","conditions":[{"source":"context","comparison":"equals","values":["ERRO NOME","ERRO EMAIL","ERRO NUMERO PEDIDO","ERRO NOTA","ERRO CPF/CNPJ"],"variable":"exception@redirectMenu","$$hashKey":"object:4455"}],"$invalid":false,"$$hashKey":"object:4387"},{"stateId":"966e32e7-e7b2-4831-be8e-2e4d89ab6b70","typeOfStateId":"state","$connId":"con_43","$id":"0635f0e5-350d-4d23-a131-bdcd25f2c4ec","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"returnException","$$hashKey":"object:4471"}],"$invalid":false,"$$hashKey":"object:4388"},{"stateId":"ec24aa87-3496-4366-8bf1-43cdf503265a","typeOfStateId":"state","$connId":"con_48","$id":"ff0bb540-90f4-42dd-8368-93b37bf6ba79","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:4485"}],"$invalid":false,"$$hashKey":"object:4389"}],"$enteringCustomActions":[{"$id":"e1e32913-720e-46da-91bc-9572c948db8b","$typeOfContent":"","type":"ExecuteScript","$title":"inactivity","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    try {\n        exception = JSON.parse(exception)\n\n        if (exception.input == \"\") {\n            return true\n        }\n        return false\n    }\n    catch (e) {\n        return \"error\"\n    }\n}","inputVariables":["exception"],"outputVariable":"inactivity","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b2d94a35-4b59-4905-9ff7-293907050f92","$typeOfContent":"","type":"SetVariable","$title":"setCountError","$invalid":false,"settings":{"variable":"countError","value":"0"},"conditions":[{"source":"context","comparison":"notExists","variable":"countError","values":[]}]},{"$id":"05f551fa-6584-49bc-b7c6-d1a549106cec","$typeOfContent":"","type":"ExecuteScript","$title":"processCountError","$invalid":false,"settings":{"function":"run","source":"function run(countError, previousException, exception) {\n    try {\n        countError = Number(countError)\n        previousException = JSON.parse(previousException)\n        exception = JSON.parse(exception)\n\n        if(countError > 1){\n            return countError = 0\n        }\n        if (previousException.id == exception.id) {\n            return countError += 1\n        }\n\n        return countError = 1\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["countError","previousException","exception"],"outputVariable":"countError","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"inactivity","$$hashKey":"object:4643"}]},{"$id":"883d49f3-7dbf-434a-9053-1082ad66801b","$typeOfContent":"","type":"ExecuteScript","$title":"processPreviousException","$invalid":false,"settings":{"function":"run","source":"function run(previousException, exception) {\n    try {\n        previousException = JSON.parse(previousException)\n        exception = JSON.parse(exception)\n\n        if (previousException.id != exception.id) {\n            return previousException = exception\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["previousException","exception"],"outputVariable":"previousException","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"19716dbd-22db-4bd5-85e6-a158605ab245","$typeOfContent":"","type":"ExecuteScript","$title":"messageErrorFormatJs","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n    exception = JSON.parse(exception)\n    let inputType = exception.input\n\n    const regex = {\n        \"image\": /image/,\n        \"audio\": /audio/,\n        \"video\": /video/,\n        \"emoji\": /[\\u2600-\\u26ff]|[\\u2600-\\u27ff]|[\\u2700-\\u27bf]|\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]|\\ud83c[\\udf00-\\udfff]|\\ud83d[\\udc00-\\ude4f]|\\ud83d[\\ude80-\\udeff]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\udffb-\\udfff]/,\n        \"link\" : /^(((https?:\\/\\/)[^\\s.]+|(www))\\.[\\w][^\\s]+)$/,\n        \"arquivo\": /application|text\\/csv|text\\/html/,\n        \"figurinha\": /application\\/octet-stream|image\\/webp/\n    }\n\n\n    if(inputType.match(regex.image)){\n        return \"Ainda n√£o sei processar imagens. \\n\\n{{n1}}Entendo apenas texto. üòâ{{n2}}\"\n    }\n\n    if(inputType.match(regex.audio)){\n        return \"Ainda n√£o consigo entender arquivos de √°udio, {{n1}}mas podemos conversar por texto. üòâ{{n2}}\"\n    }\n\n    if(inputType.match(regex.video)){\n        return \"Por enquanto n√£o consigo assistir v√≠deos, {{n1}}mas voc√™ pode conversar comigo por texto. üòâ{{n2}}\"\n    }\n\n    if(inputType.match(regex.emoji) || inputType.match(regex.figurinha)){\n        return \"Ainda n√£o consigo ler emojis ou figurinhas. Por enquanto, {{n1}}s√≥ mensagens de texto. üòâ{{n2}}\"\n    }\n\n    if(inputType.match(regex.arquivo)){\n        return \"Ainda n√£o entendo este tipo de conte√∫do.\\n\\n{{n1}}Por enquanto s√≥ consigo ler mensagens de texto. üòâ{{n2}}\"\n    }\n      \n    if(inputType.match(regex.link)){\n        return \"Ainda n√£o consigo acessar nenhum link, {{n1}}mas voc√™ pode conversar comigo por texto.{{n2}}\"\n    }\n\n    return \"OUTRO ERRO\"\n}\n","inputVariables":["exception"],"outputVariable":"messageErrorFormatJs","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-d7ac0013-2e45-4410-98b7-9d522e17192b","label":"SetVariable","background":"#b80000","canChangeBackground":false},{"id":"blip-tag-8bd09876-c866-4979-adef-faa3753cb406","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","root":false,"$title":"REQUIREMENTS","$position":{"top":"199px","left":"225px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff","commentsIdList":[]}},"e4484b9f-a98a-4544-8a8a-1138c84599a5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3ed14941-bd24-4013-a18d-1f4c6e4ace91","$typeOfContent":"","type":"SetVariable","$title":"clearException","$invalid":false,"settings":{"variable":"exception"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Exce√ß√µes"},"address":"finalizacao"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false},{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"e4484b9f-a98a-4544-8a8a-1138c84599a5","root":false,"$title":"[REDIRECT TO] Finalizar","$position":{"top":"369.75px","left":"1017.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"9d03752e-ab57-4b09-867c-a0123405f794":{"$contentActions":[{"action":{"$id":"3603a4ad-a386-4ce4-961e-4c27d12ddd84","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e7f81448-4fc5-449f-86a4-201bfa0f0c11","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e7f81448-4fc5-449f-86a4-201bfa0f0c11","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33dedaf4-60d1-47c8-b756-26a38f4812f4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"79a882fb-0676-4697-b48d-7cdeae7a014f","type":"text/plain","content":"{{phraseErrorWithInputJs}}","metadata":{}},"$cardContent":{"document":{"id":"79a882fb-0676-4697-b48d-7cdeae7a014f","type":"text/plain","content":"{{phraseErrorWithInputJs}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1472e4b5-0834-4fab-ac3d-1f24e24d44a9","type":"text/plain","textContent":"User input","content":"name"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"name"},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"cd1180a1-6190-40f9-83d4-afd6dec1102a","$typeOfContent":"","type":"TrackEvent","$title":"erro input exibicao","$invalid":false,"settings":{"extras":{},"category":"erro input exibicao","action":"exibicao"},"conditions":[]},{"$id":"a086fa26-3b26-4e34-a3a6-1284f6e800a6","$typeOfContent":"","type":"ExecuteScript","$title":"phraseErrorWithInputJs","$invalid":false,"settings":{"function":"run","source":"function run(exception, validInputJs) {\n    try {\n        let exceptionJs = JSON.parse(exception).redirectMenu\n        let validation = JSON.parse(validInputJs).validation\n\n        if (exceptionJs == 'ERRO NOME') {\n            return `Desculpe, n√£o consegui entender o seu nome. ‚úñÔ∏è\\n\\n{{n1}}üí° Digite somente texto.{{n2}}`\n        }\n        if (exceptionJs == 'ERRO EMAIL') {\n            return `Desculpe, n√£o consegui entender o e-mail informado. ‚úñÔ∏è\\n\\n{{n1}}üí° Digite conforme o exemplo a seguir:{{n2}} ajinomoto@chatbot.com.br`\n        }\n        if (exceptionJs == 'ERRO CPF/CNPJ' && validation == 'cpf') {\n            return `Desculpe, n√£o consegui entender o CPF que voc√™ digitou. ‚úñÔ∏è\\n\\n{{n1}}üí° Digite conforme o exemplo:{{n2}}\\n12378945612`\n        }\n        if (exceptionJs == 'ERRO NOTA') {\n            return `Desculpe, {{n1}}eu n√£o consegui entender qual a nota que voc√™ informou. ‚úñÔ∏è{{n2}}\\n\\nüí° Digite um n√∫mero entre 0 e 10.`\n        }\n\n        if(exceptionJs == 'ERRO NUMERO PEDIDO'){\n            return `Desculpe, {{n1}}eu n√£o consegui entender o n√∫mero do pedido que voc√™ informou.  ‚úñÔ∏è{{n2}}\\n\\nüí°Digite os 9 d√≠gitos num√©ricos.`\n        }\n    }\n    catch (e) {\n        return 'error'\n    }\n\n}","inputVariables":["exception","validInputJs"],"outputVariable":"phraseErrorWithInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d171860a-9158-4049-86ae-83db779e7eb8","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [true]","$invalid":false,"settings":{"variable":"hideInputText","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-68d0da90-ee55-427f-b191-c23f165f3b2e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false}],"id":"9d03752e-ab57-4b09-867c-a0123405f794","root":false,"$title":"[X.2.0.0] Erro Input","$position":{"top":"332px","left":"226px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e5d6ae6-a400-4267-a294-9b22fc707da7":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3395"},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false,"$$hashKey":"object:3396"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false,"$$hashKey":"object:3397"}],"$conditionOutputs":[{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_53","$id":"c30560be-2a56-408c-b3fc-0407bc5ea2d5","conditions":[{"source":"input","comparison":"notExists","values":[],"$$hashKey":"object:3422"}],"$invalid":false,"$$hashKey":"object:3405"},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_138","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Finalizar conversa"],"variable":"validInputJs@input","$$hashKey":"object:3434"}],"$invalid":false,"$$hashKey":"object:3406"},{"stateId":"54d99b2c-b338-4f12-a938-59ab815c9e4d","typeOfStateId":"state","$connId":"con_63","$id":"a86566b5-fd6d-45a5-b6c4-e91d9c0f398f","conditions":[{"source":"context","comparison":"equals","values":["Retomar conversa"],"variable":"validInputJs@input","$$hashKey":"object:3448"}],"$invalid":false,"$$hashKey":"object:3407"}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  let properties = {\n    'text': `Eu ainda posso te ajudar em mais alguma coisa? üòÅ`,\n    'options': [\"Retomar conversa\", \"Finalizar conversa\"],\n    'values': [\"Retomar conversa\", \"Finalizar conversa\"],\n    'description': [],\n    'itens': [\n      { name: ['Retomar conversa', 'Retomar'] },\n      { name: ['Finalizar conversa', 'Finalizar'] }\n    ]\n  }\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adi√ß√£o de op√ß√µes sem numera√ß√£o\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numera√ß√£o autom√°tica\n  }\n  return newItens;\n} \n","inputVariables":[],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": true,\n      \"blipchatMenu\": false,\n      \"defaultText\": false,\n      \"platform\": convertPlatform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18db78c0-fa11-4575-866e-6f13d900f271","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"inatividade exibicao","$invalid":false,"settings":{"extras":{},"category":"inatividade exibicao","action":"exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'SAIR'\n            return JSON.stringify(processedInput)\n        } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'MENU'\n            return JSON.stringify(processedInput)\n        }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d08c3020-a556-4042-bce3-fb1b1be6df92","$typeOfContent":"","type":"SetVariable","$title":"inactivity","$invalid":false,"settings":{"variable":"inactivity","value":"false"},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"inatividade selecao","$invalid":false,"settings":{"extras":{},"category":"inatividade selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"inatividade inesperado","$invalid":false,"settings":{"extras":{},"category":"inatividade inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#ffe500","label":"UserInput","id":"blip-tag-dbc9a043-f12b-4db2-98bd-6b11c3074486","canChangeBackground":false}],"id":"0e5d6ae6-a400-4267-a294-9b22fc707da7","$title":"[I.0.0.0] [MENU] - Inatividade 2h","$position":{"top":"480px","left":"423px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff","commentsIdList":[]}},"3c64385e-253b-43d0-9316-aabd7c5e15cb":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3ed14941-bd24-4013-a18d-1f4c6e4ace91","$typeOfContent":"","type":"SetVariable","$title":"clearException","$invalid":false,"settings":{"variable":"exception"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Transbordo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Exce√ß√µes"},"address":"transbordo"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#b80000","label":"SetVariable","id":"blip-tag-dd432ee6-0ca2-4264-9382-6348da5c46b1","canChangeBackground":false},{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false}],"id":"3c64385e-253b-43d0-9316-aabd7c5e15cb","root":false,"$title":"[REDIRECT TO] Transbordo","$position":{"top":"238.75px","left":"1016.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"a680148c-4492-4f88-a562-58c33c6c4271":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4150"},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{contentJs}}"}},"$invalid":false,"$$hashKey":"object:4151"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false,"$$hashKey":"object:4152"}],"$conditionOutputs":[{"stateId":"3c64385e-253b-43d0-9316-aabd7c5e15cb","typeOfStateId":"state","$connId":"con_68","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["Falar com atendente"],"variable":"validInputJs@input","$$hashKey":"object:4175"}],"$invalid":false,"$$hashKey":"object:4160"},{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","typeOfStateId":"state","$connId":"con_73","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Finalizar conversa ‚ùé"],"variable":"validInputJs@input","$$hashKey":"object:4189"}],"$invalid":false,"$$hashKey":"object:4161"}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  let properties = {\n    'text': `Desculpe, eu realmente n√£o estou conseguindo entender o que voc√™ quer me dizer. üòì\\n\\n{{n1}}O que gostaria de fazer agora?{{n2}}`,\n    'options': [\"Falar com atendente\", \"Finalizar conversa ‚ùé\"],\n    'values': [\"Falar com atendente\", \"Finalizar conversa ‚ùé\"],\n    'description': [],\n    'itens': [\n      { name: ['Falar com atendente', 'Falar', 'Atendente', 'Com atendente'] },\n      { name: ['Finalizar conversa ‚ùé', 'Finalizar conversa',  'Conversa', 'Finalizar', '‚ùé'] }\n    ]\n  }\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adi√ß√£o de op√ß√µes sem numera√ß√£o\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma varia√ß√£o lowerCase e UpperCase para cada op√ß√£o do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${ i + 1 }`); // Acrescenta numera√ß√£o autom√°tica\n  }\n  return newItens;\n} \n","inputVariables":[],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  let convertPlatform = platform.toLowerCase();\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": true,\n      \"blipchatMenu\": false,\n      \"defaultText\": false,\n      \"platform\": convertPlatform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18db78c0-fa11-4575-866e-6f13d900f271","$typeOfContent":"","type":"ExecuteScript","$title":"contentJs","$invalid":false,"settings":{"function":"run","source":"function run(menu, platform, objMenu) {\n  objMenu = JSON.parse(objMenu);\n  platform = platform.toLowerCase();\n\n  switch (platform) {\n    case 'instagram':\n      return geraMenuNumerico(menu);\n\n    case 'messenger':\n      return geraMenuNumerico(menu);\n\n    default:\n      return objMenu.content;\n  }\n}\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["inputOptionJs","platform","objMenu"],"outputVariable":"contentJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"erro persistente exibicao","$invalid":false,"settings":{"extras":{},"category":"erro persistente exibicao","action":"exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando h√° alguma palavra reservada que o bot dever√° processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma valida√ß√£o dever√° retornar um erro para cair em exce√ß√£o\n// - success => quando a valida√ß√£o foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input ap√≥s processamento.\n// - Se type == error => o input ser√° a descri√ß√£o do erro. Ex: ERRO CEP\n// - Se type == success => o input ser√° o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual valida√ß√£o o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATEN√á√ÉO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para valida√ß√£o de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de valida√ß√£o de input vai ser  \n        //   necess√°rio (se mais de um for selecionado, apenas o mais acima ser√° validado)\n        // - erroMenuEspecial => altere somente se, caso a valida√ß√£o seja um Menu e para\n        //   este menu haja um tratamento diferente de exce√ß√£o.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que ser√° retornado pela fun√ß√£o\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usu√°rio digitou SAIR ou MENU\n        if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'SAIR'\n            return JSON.stringify(processedInput)\n        } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n            processedInput.type = 'reserved'\n            processedInput.input = 'MENU'\n            return JSON.stringify(processedInput)\n        }\n\n        // Formata vari√°veis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Valida√ß√£o de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Din√¢mico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Valida√ß√£o de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma valida√ß√£o foi processada, retorna o input sem valida√ß√£o\n            if (processedInput.input == 'INPUT SEM VALIDA√á√ïES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"erro persistente selecao","$invalid":false,"settings":{"extras":{},"category":"erro persistente selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"erro persistente inesperado","$invalid":false,"settings":{"extras":{},"category":"erro persistente inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]},{"$id":"914af8a0-bf18-43eb-bdc5-b4c660083ecf","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput) {\n    try {\n        typeInput = JSON.parse(typeInput).input\n        let idFormated = previousState.split(' ');\n        idFormated = idFormated[0].replace(/\\[/g,'').replace(/\\]/g,'').replace(/\\./g,'');\n        const exception = {\n            id: `${idFormated}`,\n            input: `{{input.content}}`,\n            redirectMenu: `${typeInput}`,\n            blockId: previousId\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["state.previous.name","validInputJs","state.previous.id"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e4484b9f-a98a-4544-8a8a-1138c84599a5","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#ffe500","label":"UserInput","id":"blip-tag-dbc9a043-f12b-4db2-98bd-6b11c3074486","canChangeBackground":false}],"id":"a680148c-4492-4f88-a562-58c33c6c4271","$title":"[E.0.0.5] [MENU] - Erro Persistente","$position":{"top":"328px","left":"421px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff","commentsIdList":[]}},"966e32e7-e7b2-4831-be8e-2e4d89ab6b70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aebf3f0a-56ac-4466-b042-70cabc54dbf4","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4002"}],"$conditionOutputs":[{"typeOfStateId":"variable","$id":"5a5e1d62-fe29-4e31-87f5-baa07e27c542","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"returnBlockId","$$hashKey":"object:4015"}],"$invalid":false,"stateId":"{{exception@blockId}}","$$hashKey":"object:4004"}],"$enteringCustomActions":[{"$id":"ad440f48-87c3-4fa8-be77-43d1b0e5b835","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"false"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-3bd66a4b-ba56-e3ff-bda5-086e2b1011ab","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-4aa4c2fb-0942-4bc3-8a18-f380707e0fb8","canChangeBackground":false}],"id":"966e32e7-e7b2-4831-be8e-2e4d89ab6b70","root":false,"$title":"Retorno Exce√ß√£o","$position":{"top":"205px","left":"422px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#eb9694","textColor":"#000000","commentsIdList":[]},"invalidOutputs":true}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}