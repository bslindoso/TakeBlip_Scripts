{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"1c27dfa3-2968-40a7-bb7d-e07499eda823","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"74.1429px","left":"1062.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"707ddd82-ac70-4497-ac43-7bc2760e04ea","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","typeOfStateId":"state","$connId":"con_3","$id":"8be4dbc8-c01d-43cd-823b-a4f2f99fd33b","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"error","conditions":[{"source":"input","comparison":"exists","values":[]}],"$id":"2b261064-4ccb-44a4-ae37-67890ed2d033","$connId":"con_152","$invalid":false}],"$enteringCustomActions":[{"$id":"b7d8a5e8-fe2c-4a36-827d-db4e935f9c3d","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput) {\n    try {\n        typeInput = JSON.parse(typeInput).input\n        let idFormated = previousState.split(' ');\n        idFormated = idFormated[0].replace(/\\[/g,'').replace(/\\]/g,'').replace(/\\./g,'');\n        const exception = {\n            id: `${idFormated}`,\n            input: '{{input.content}}',\n            redirectMenu: `${typeInput}`\n        }\n        return exception\n    }\n    catch (e) {\n        return 'error'\n    }\n}","inputVariables":["state.previous.name","validInputJs"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"45px","left":"2201.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"bd3723bc-57d6-4c11-a044-91124ea4b164","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e36a0bc8-ec21-4a6a-a9b3-7838123a8871","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e36a0bc8-ec21-4a6a-a9b3-7838123a8871","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"86ef009e-9cbb-4a58-84cb-de8b9c2979c2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"61b62d37-b294-4964-bf03-5fca0311b128","type":"text/plain","content":"Seja bem vindo.","metadata":{}},"$cardContent":{"document":{"id":"61b62d37-b294-4964-bf03-5fca0311b128","type":"text/plain","content":"Seja bem vindo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"name"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"name","expiration":"2:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","typeOfStateId":"state","$connId":"con_13","$id":"0f6b1bf2-43e1-4b21-aec9-0306cd16646e","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"privacyPolicy"}],"$invalid":false},{"stateId":"5c234a8d-7660-4245-858f-f8867217bdf1","typeOfStateId":"state","$connId":"con_18","$id":"983c6c1b-8062-44c8-abdd-72d9c2cece0c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"boas vindas plx exibicao","$invalid":false,"settings":{"extras":{},"category":"boas vindas plx exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"956fc0bd-1e9d-4582-8f5b-5454b8aff552","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-3bd66a4b-ba56-e3ff-bda5-086e2b1011ab","canChangeBackground":false}],"id":"welcome","$title":"[BV.1.0.0] Apresentação","$position":{"top":"281px","left":"1069px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fbf92afc-a1bf-400c-8e40-22d772bf16fa","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"66b8efe1-ec32-419c-976e-462c8dfa7384","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Exceções","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{serviceList@excecao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-31fd5180-97e8-b29a-b296-110803b6277e","canChangeBackground":false}],"id":"error","$title":"[REDIRECT TO] Exceções","$position":{"top":"33px","left":"2406px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"f4078b7c-fd36-47ec-a5d6-57e5392cddaa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d177afe0-1fc9-47f7-8d6d-a8888d6c114c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:555"}],"$conditionOutputs":[{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","typeOfStateId":"state","$connId":"con_23","$id":"a17ba024-c7ef-41d5-b0c7-0911a84d6fb5","conditions":[{"source":"input","comparison":"equals","values":["Menu"],"$$hashKey":"object:644"}],"$invalid":false,"$$hashKey":"object:632"},{"stateId":"a9bb41ca-9bef-4b1d-a5ca-a3688ef77898","typeOfStateId":"state","$connId":"con_28","$id":"a67efdf5-bbfd-4800-b030-2378aacdf05f","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"returnException","$$hashKey":"object:654"}],"$invalid":false,"$$hashKey":"object:633"},{"stateId":"15916985-02e7-4b57-bb99-afa74b5eaaa7","typeOfStateId":"state","$connId":"con_197","$id":"92093d7d-4ec2-45fa-a5c6-7ea747c187cd","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"return","$$hashKey":"object:666"},{"source":"context","comparison":"exists","values":[],"variable":"return","$$hashKey":"object:667"}],"$invalid":false,"$$hashKey":"object:634"},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_38","$id":"6a92a1c2-2268-4114-a92e-ee5f30f5a409","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:687"}],"$invalid":false,"$$hashKey":"object:635"}],"$enteringCustomActions":[{"$id":"98c87606-f80d-41c9-85b9-ba045acd21be","$typeOfContent":"","type":"SetVariable","$title":"SERVICE","$invalid":false,"settings":{"variable":"service","value":"boasvindas"},"conditions":[]},{"$id":"d3a5114c-7cef-4f0d-af4a-31e3c74f7d07","$typeOfContent":"","type":"ExecuteScript","$title":"GET PLATFORM","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const DEFAULT_CHANNEL = 'default';\n    const CHANNEL_INDEX = 1;\n\n    const CHANNEL_IDENTIFIERS = {\n        'wa.gw.msging.net': 'WhatsApp',\n        '0mn.io': 'BlipChat',\n        'take.io': 'TakeSMS',\n        'messenger.gw.msging.net': 'Messenger',\n        'instagram.gw.msging.net': 'Instagram',\n        'abs.gw.msging.net': 'Teams',\n        'businessmessages.gw.msging.net': 'gbm',\n        'skype.gw.msging.net': 'Skype',\n        'telegram.gw.msging.net': 'Telegram',\n        'workplace.gw.msging.net': 'Workplace',\n        'mailgun.gw.msging.net': 'Email',\n        'pagseguro.gw.msging.net': 'PageSeguro'\n    };\n\n    let contactChannelId = contactIdentity.split('@')[CHANNEL_INDEX];\n\n    return CHANNEL_IDENTIFIERS[contactChannelId] || DEFAULT_CHANNEL;\n}","inputVariables":["contact.identity"],"outputVariable":"platform","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1e0a12c3-3bd0-45b8-9592-898a0d17fb7a","$typeOfContent":"","type":"ExecuteScript","$title":"CHANNEL TAGS","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\nfunction run(platform) {\n  return channelTags(platform);\n}","inputVariables":["platform"],"outputVariable":"channelTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c185e811-51f6-4036-bb91-b84d8a08be1e","$typeOfContent":"","type":"ExecuteScript","$title":"Whatsapp Number","$invalid":false,"settings":{"function":"run","source":"function run(contact) {\n    \n    // Sem o código do país         \n    // let phone = contact.split(\"@\")[0].replace(\"55\", \"\");   \n\n    // Com o código do país\n    let phone = contact.split(\"@\")[0];   \n    let tamanho = phone.length;\n\n\n    if(tamanho == 10){\n        \n        let telefone = phone.split('').join().replace(/\\D/g, '');\n        let math = Math.floor(telefone.length - 8 ); \n        let concat = telefone.substr(0,math)+\"9\"+telefone.substr(math);\n        let retorno = concat;\n\n        return retorno;\n    }\n    if(tamanho == 11){\n        \n        let retorno = phone\n        return retorno;\n    }\n\n}","inputVariables":["contact.identity"],"outputVariable":"wanumber","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"platform","values":["Whatsapp"]}]},{"$id":"2b67cddf-03af-41f5-a723-07176d8344eb","$typeOfContent":"","type":"ProcessHttp","$title":"GET Whatsapp Information","$invalid":false,"settings":{"headers":{"Authorization":"{{resource.keyRouterBlip}}","Content-Type":"application/json"},"method":"POST","body":"{\n\"id\": \"{{$guid}}\",\n\"to\": \"postmaster@wa.gw.msging.net\",\n\"method\": \"get\",\n\"uri\": \"lime://wa.gw.msging.net/accounts/{{wanumber}}\"\n}","uri":"https://http.msging.net/commands","responseStatusVariable":"statusWppInfo","responseBodyVariable":"responseWppInfo"},"conditions":[{"source":"context","comparison":"equals","variable":"platform","values":["WhatsApp"]}]},{"$id":"ce22a169-7f63-4bd6-b375-ace0b1246918","$typeOfContent":"","type":"MergeContact","$title":"SET Whatsapp Full Name","$invalid":false,"settings":{"extras":{},"name":"{{responseWppInfo@resource.fullName}}"},"conditions":[{"source":"context","comparison":"equals","variable":"platform","values":["Whatsapp"]}]},{"$id":"9723fb17-392b-4ef1-ab2d-d6fa1757bb60","$typeOfContent":"","type":"SetVariable","$title":"openBold","$invalid":false,"settings":{"variable":"n1","value":"{{channelTags@bold.open}}","expiration":null},"conditions":[]},{"$id":"d6ecf2df-35e3-47bc-9895-c41306197d45","$typeOfContent":"","type":"SetVariable","$title":"closeBold","$invalid":false,"settings":{"variable":"n2","value":"{{channelTags@bold.close}}"},"conditions":[]},{"$id":"9149107e-580b-4eb3-8eb9-165b47482575","$typeOfContent":"","type":"SetVariable","$title":"openItalic","$invalid":false,"settings":{"variable":"i1","value":"{{channelTags@italic.open}}"},"conditions":[]},{"$id":"56e47675-bdb9-4f24-bd2e-83ce80b7c6c0","$typeOfContent":"","type":"SetVariable","$title":"closeItalic","$invalid":false,"settings":{"variable":"i2","value":"{{channelTags@italic.close}}"},"conditions":[]},{"$id":"bdb84258-dd8b-45a5-a69c-3a169bebf84e","$typeOfContent":"","type":"SetVariable","$title":"italicValue","$invalid":false,"settings":{"variable":"italicValue","value":"{{channelTags@italic}}"},"conditions":[]},{"$id":"1f61d402-4ad1-4114-9fc5-d68eab7daed7","$typeOfContent":"","type":"ExecuteScript","$title":"Service List","$invalid":false,"settings":{"function":"run","source":"const run = () => {\n\n    const serviceList = {\n        boas_vindas: \"boasvindas\",\n        excecao: \"excecao\",\n        finalizacao: \"finalizacao\",\n        nota: \"csat\",\n        transbordo: \"transbordo\",\n        algo_mais: \"algomais\"\n    };\n\n    return serviceList;\n}","inputVariables":[],"outputVariable":"serviceList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca9635dc-962c-4ff8-a20b-c2f4c0fe9dbd","$typeOfContent":"","type":"ExecuteScript","$title":"ValidaRetorno","$invalid":false,"settings":{"function":"run","source":"function run(nome, email, politica, reserva, ultimoBlocoOndeParou) {\n    try {\n        // Verifica se ultimoBlocoOndeParou é uma string ou um objeto. caso seja uma string, converte para objeto\n        (typeof (ultimoBlocoOndeParou) == 'string') ? ultimoBlocoOndeParou = JSON.parse(ultimoBlocoOndeParou) : ultimoBlocoOndeParou\n\n        // Valida se o usuário preencheu todos os dados\n        if (\n            (!nome || nome == '' || nome == undefined || nome == 'undefined' || nome == 'null' || nome == null) ||\n            (!email || email == '' || email == undefined || email == 'undefined' || email == 'null' || email == null) ||\n            (!politica || politica == '' || politica == undefined || politica == 'undefined' || politica == 'null' || politica == null) ||\n            (!reserva || reserva == '' || reserva == undefined || reserva == 'undefined' || reserva == 'null' || reserva == null)\n        ) {\n            // Valida se há a propriedade service e exception\n            if (!ultimoBlocoOndeParou || !ultimoBlocoOndeParou.hasOwnProperty('service') || !ultimoBlocoOndeParou.hasOwnProperty('exception')) {\n                return 'dados ausentes: sem bloco onde parou'\n            }\n            // dados ausentes, volta para o bloco onde parou.\n            return 'dados ausentes';\n        } else {\n            // dados completos, ir para retorno padrão\n            return 'dados completos'\n        }\n    } catch (e) {\n        // Aqui vai cair quando ultimoBlocoOndeParou não existe, ou outro erro desconhecido.\n        console.log(e)\n        return 'erro desconhecido';\n    }\n}","inputVariables":["contact.name","contact.email","contact.extras.PrivacyPolicy","contact.extras.Reserva","ultimoBlocoOndeParou"],"outputVariable":"validaRetorno","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-3bd66a4b-ba56-e3ff-bda5-086e2b1011ab","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-d2f6d32a-8f3d-ae80-2164-881f1467e0ac","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-34536386-696f-5928-5ea7-4c06b8dfb34e","canChangeBackground":false}],"id":"f4078b7c-fd36-47ec-a5d6-57e5392cddaa","root":false,"$title":"[REQUIREMENTS]","$position":{"top":"166px","left":"1064px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff","commentsIdList":[]}},"3b904cac-d437-46b1-8b32-fe2450a423d7":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{objMenu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"06df1fa4-e643-463d-96ca-411ca4313aa9","typeOfStateId":"state","$connId":"con_43","$id":"91f8823d-95f0-4e50-b19b-ab291c87fb0d","conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n\n  let properties = {\n    text: 'Certo! Selecione a seguir como eu posso te ajudar hoje. 👇',\n    options: [\"Bot Simples\", \"Bot Único Bloco\", \"CSAT\", \"Transbordo\", \"Algo Mais\", \"Finalização\"],\n    values: [\"Bot Simples\", \"Bot Único Bloco\", \"CSAT\", \"Transbordo\", \"Algo Mais\", \"Finalização\"],\n    description: [],\n    itens: [\n      { name: ['Bot Simples'] },\n      { name: ['Bot Único Bloco'] },\n      { name: ['CSAT'] },\n      { name: ['Transbordo'] },\n      { name: ['Algo Mais'] },\n      { name: ['Finalização'] }\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exceção no MENU\n  if (hideInputText == 'true' || hideInputText == true) {\n    properties.text = sentenceOtherMistakesJs\n  } else {\n    // Exibe mensagem de retorno\n    // if (returnJs == 'true' || returnJs == true) {\n    //   properties.text = 'Certo! Selecione a seguir como eu posso te ajudar hoje. 👇'\n    // }\n  }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objMenu = {\n      'type': `text/plain`,\n      'content' : geraMenuNumerico(menu)\n    }\n    return objMenu\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ... menu.menuScope,\n      \"platform\": platform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"19b44b1c-95c2-4d6f-be90-4d0f0d3f8a6e","$typeOfContent":"","type":"TrackEvent","$title":"menu principal exibicao","$invalid":false,"settings":{"extras":{},"category":"menu principal exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            data: false,\n            email: false,\n            cep: false,\n            img: false,\n            imgTxt: false,\n            nome: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"092f69c0-91e0-4bf9-9a50-a6217e8ae04d","$typeOfContent":"","type":"ExecuteScript","$title":"destination","$invalid":false,"settings":{"function":"run","source":"function run(validInput) {\n  let input = JSON.parse(validInput).input\n\n  getOptionSelected = (input) => {\n      const optionList = {\n          'Bot Simples': 'botsimples',\n          'Bot Único Bloco': 'botunicobloco',\n          'CSAT': 'csat',\n          'Transbordo': 'transbordo',\n          'Algo Mais': 'algomais',\n          'Finalização': 'finalizacao'\n      }\n\n      return optionList[input] || 'ERROR: NO MATCH'\n  }\n\n  return getOptionSelected(input);\n}","inputVariables":["validInputJs"],"outputVariable":"destination","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]}]},{"$id":"df568ace-ba78-4a52-9b1f-95e2cbbdca70","$typeOfContent":"","type":"SetVariable","$title":"menu opcao escolhida","$invalid":false,"settings":{"variable":"menuOptEscolhida","value":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"menu principal selecao","$invalid":false,"settings":{"extras":{},"category":"menu principal selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"menu principal input inesperado","$invalid":false,"settings":{"extras":{},"category":"menu principal input inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]},{"$id":"3bf5dbe0-4929-423e-a075-dcc5768a9460","$typeOfContent":"","type":"SetVariable","$title":"return - true","$invalid":false,"settings":{"variable":"return","value":"true"},"conditions":[]},{"$id":"7e8a0258-b590-4e06-89f5-389601bc1300","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false}],"id":"3b904cac-d437-46b1-8b32-fe2450a423d7","$title":"[BV.1.0.0] [MENU] Menu Principal","$position":{"top":"292px","left":"1926px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff"}},"9ac915cd-e394-4f79-b59e-b1e1a66dcfb4":{"$contentActions":[{"action":{"$id":"06ead6ca-1a30-4b6e-9f98-2ad6052c7294","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3a6735d0-8420-488b-aaea-cb5858ded83c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3a6735d0-8420-488b-aaea-cb5858ded83c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3148"},{"action":{"$id":"71ee7cdb-f07b-4c32-baee-01443f122c9c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7f2b7c9f-dfcf-4ec9-a857-1673c289a939","type":"text/plain","content":"Bem vindo de volta!","metadata":{}},"$cardContent":{"document":{"id":"7f2b7c9f-dfcf-4ec9-a857-1673c289a939","type":"text/plain","content":"Bem vindo de volta!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3149"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3150"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"retorno Exibicao","$invalid":false,"settings":{"extras":{},"category":"retorno Exibicao","action":"Exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"76f9df67-5706-47f9-baa2-6f6c173a6452","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"id":"blip-tag-d2fad23e-0ffd-4ff0-98c5-c3845d204031","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"9ac915cd-e394-4f79-b59e-b1e1a66dcfb4","$title":"[R.1.0.0] Retorno","$position":{"top":"77px","left":"469px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a9bb41ca-9bef-4b1d-a5ca-a3688ef77898":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aebf3f0a-56ac-4466-b042-70cabc54dbf4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{returnBlockId}}","typeOfStateId":"variable","$id":"5a5e1d62-fe29-4e31-87f5-baa07e27c542","conditions":[{"source":"context","comparison":"notEquals","values":["ERROR"],"variable":"returnBlockId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ad440f48-87c3-4fa8-be77-43d1b0e5b835","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"false"},"conditions":[]},{"$id":"c8ef55ca-3bf7-4e60-8e94-8a2a9ae327c5","$typeOfContent":"","type":"ExecuteScript","$title":"returnBlockId","$invalid":false,"settings":{"function":"run","source":"function run(exception) {\n  try {\n    exception = JSON.parse(exception)\n    const exceptionId = exception.id\n\n    const blockList = [\n      { exceptionId: \"BV100\", blockId: \"3b904cac-d437-46b1-8b32-fe2450a423d7\" },\n      { exceptionId: \"BV130\", blockId: \"e7599a62-7568-4ff4-930e-b51716e74d60\" },\n      { exceptionId: \"BV220\", blockId: \"f80ec11d-a4bc-4632-8af4-86e32ad89c20\" },\n    ]\n\n    let returnBlockId = \"\"\n\n    blockList.forEach(element => {\n      var find = exceptionId == element.exceptionId ? element.blockId : ''\n      if (find != '') {\n        returnBlockId = find\n      }\n    })\n\n    if (returnBlockId == \"\") {\n      returnBlockId = \"ERROR: COULDN'T MATCH EXCEPTION ID. DID YOU LINKED EXCEPTION ID TO BLOCK ID?\"\n    }\n\n    return returnBlockId\n  } catch (e) {\n    return \"ERROR: SCRIPT FAILURE\"\n  }\n}","inputVariables":["exception"],"outputVariable":"returnBlockId","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-3bd66a4b-ba56-e3ff-bda5-086e2b1011ab","canChangeBackground":false}],"id":"a9bb41ca-9bef-4b1d-a5ca-a3688ef77898","root":false,"$title":"Retorno Exceção","$position":{"top":"40.25px","left":"1294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#eb9694","textColor":"#000000"}},"23db93b0-a85a-41fa-8b51-374afe7e7b68":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"finalizacao"},"address":"{{serviceList@finalizacao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-31fd5180-97e8-b29a-b296-110803b6277e","canChangeBackground":false}],"id":"23db93b0-a85a-41fa-8b51-374afe7e7b68","root":false,"$title":"[REDIRECT TO] Finalização","$position":{"top":"163px","left":"2406px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"3b3a1408-7f24-45dc-b193-40fe62bb4fd7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Transbordo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"transbordo"},"address":"{{serviceList@transbordo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-31fd5180-97e8-b29a-b296-110803b6277e","canChangeBackground":false}],"id":"3b3a1408-7f24-45dc-b193-40fe62bb4fd7","root":false,"$title":"[REDIRECT TO] Transbordo","$position":{"top":"291px","left":"2406px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"ace2c0c3-a756-49af-8d76-fe30066ba1ed":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fbf92afc-a1bf-400c-8e40-22d772bf16fa","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7d31e570-2f6e-4693-9895-eb1669fe5c4d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Service","$invalid":false,"settings":{"context":{"type":"text/plain","value":"boasvindas"},"address":"{{destination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-31fd5180-97e8-b29a-b296-110803b6277e","canChangeBackground":false}],"id":"ace2c0c3-a756-49af-8d76-fe30066ba1ed","$title":"[REDIRECT TO] Service","$position":{"top":"421.75px","left":"2406.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"06df1fa4-e643-463d-96ca-411ca4313aa9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d7ada577-de41-4e50-9c12-2bfa85cc86ae","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ace2c0c3-a756-49af-8d76-fe30066ba1ed","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#3A4A65","label":"GO TO","id":"blip-tag-2950aeab-5ffc-4bfb-8c0d-5677eb652059","canChangeBackground":false}],"id":"06df1fa4-e643-463d-96ca-411ca4313aa9","root":false,"$title":"[GO TO] Service","$position":{"top":"427.25px","left":"1926.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"cec4de82-b74b-4b7d-9062-ed144a5bd046":{"$contentActions":[{"action":{"$id":"4c92c09a-2df0-42ab-9b7c-a02500e5b307","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"48c58a25-33a0-4750-ada2-25f6e0be42f6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"48c58a25-33a0-4750-ada2-25f6e0be42f6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b50ec755-1c8c-455b-a2b7-38ee4255577c","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n    \"type\": \"template\",\n    \"template\": {\n        \"name\": \"teste_link\",\n        \"language\": {\n            \"policy\": \"deterministic\",\n            \"code\": \"pt_BR\"\n        }\n    }\n}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39ad8e73-725b-4fdd-8d0e-b2d2e4456e67","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e7599a62-7568-4ff4-930e-b51716e74d60","typeOfStateId":"state","$connId":"con_48","$id":"4bab57ef-17ff-4102-b377-b3feda901238","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fa5b5596-29d7-4e23-80f5-844952471f56","$typeOfContent":"","type":"TrackEvent","$title":"politica de privacidade oncoclinicas sac exibicao","$invalid":false,"settings":{"extras":{},"category":"politica de privacidade oncoclinicas sac exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e7599a62-7568-4ff4-930e-b51716e74d60","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false}],"id":"cec4de82-b74b-4b7d-9062-ed144a5bd046","root":false,"$title":"[BV.1.2.0] Política de Privacidade [WhatsApp]","$position":{"top":"522.25px","left":"1065.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9d9d9686-5ee9-4119-9e04-541c87fab188":{"$contentActions":[{"action":{"$id":"9c4423a7-466f-455e-91d5-aa1952a832c4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"dcbff215-4dbc-49c7-82a7-11ce5fa7af1c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dcbff215-4dbc-49c7-82a7-11ce5fa7af1c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0269d339-aec0-4753-bd76-5cd67be6ad72","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4fa4835d-7324-4a22-9136-522254c95852","type":"text/plain","content":"Mas antes, preciso saber se você está de acordo com a nossa {{n1}}política de privacidade{{n2}} no link abaixo:","metadata":{}},"$cardContent":{"document":{"id":"4fa4835d-7324-4a22-9136-522254c95852","type":"text/plain","content":"Mas antes, preciso saber se você está de acordo com a nossa {{n1}}política de privacidade{{n2}} no link abaixo:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a97bb138-bb94-4c85-8080-400b575e7a69","$typeOfContent":"web-link","type":"SendMessage","settings":{"id":"69cfcb59-f81c-4e07-8451-7247f2d712a6","type":"application/vnd.lime.web-link+json","content":{"uri":"https://grupooncoclinicas.com/o-grupo/protecao-de-dados","target":"blank","title":"Política de Privacidade","text":"Oncoclínicas","previewUri":""},"metadata":{}},"$cardContent":{"document":{"id":"69cfcb59-f81c-4e07-8451-7247f2d712a6","type":"application/vnd.lime.web-link+json","content":{"uri":"https://grupooncoclinicas.com/o-grupo/protecao-de-dados","target":"blank","title":"Política de Privacidade","text":"Oncoclínicas","previewUri":""}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8d4a410a-05de-43ad-8498-76173ec459e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e7599a62-7568-4ff4-930e-b51716e74d60","typeOfStateId":"state","$connId":"con_53","$id":"cba9c751-692a-41bd-b2d0-07d2135c3961","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"37d8adb0-3f27-468b-8fb1-4f2b753c9396","$typeOfContent":"","type":"TrackEvent","$title":"politica de privacidade oncoclinicas sac exibicao","$invalid":false,"settings":{"extras":{},"category":"politica de privacidade oncoclinicas sac exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e7599a62-7568-4ff4-930e-b51716e74d60","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false}],"id":"9d9d9686-5ee9-4119-9e04-541c87fab188","root":false,"$title":"[BV.1.2.0] Política de Privacidade [Default]","$position":{"top":"679px","left":"1066px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e7599a62-7568-4ff4-930e-b51716e74d60":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{objMenu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","typeOfStateId":"state","$connId":"con_58","$id":"4b50d6da-6cf1-44f9-bdd4-b7dcf8db0efe","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"f80ec11d-a4bc-4632-8af4-86e32ad89c20","typeOfStateId":"state","$connId":"con_63","$id":"3eff8c2b-4003-49f3-a732-5d56cd43750c","conditions":[{"source":"context","comparison":"equals","values":["Não","Nao","Menu"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"ffc9c039-0c20-4fd7-88e5-ddbd5186ee65","typeOfStateId":"state","$connId":"con_68","$id":"336b73fb-d02b-44e0-a83b-b2242947e8c3","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n\n  let properties = {\n    'text': `Está de acordo com a nossa {{n1}}política de privacidade?{{n2}}`,\n    'options': [\"Sim\", \"Não\"],\n    'values': [\"Sim\", \"Não\"],\n    'description': [],\n    'itens': [\n      { name: ['Sim', 'sim', 's', 'ss', 'yes'] },\n      { name: ['Não', 'nao', 'no', 'n', 'nn', 'nope'] }\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": true,\n      \"blipchatMenu\": false,\n      \"defaultText\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exceção no MENU\n  if (hideInputText == 'true' || hideInputText == true) {\n    properties.text = sentenceOtherMistakesJs + '\\n\\n' + properties.text\n  } else {\n    // Exibe mensagem de retorno\n    // if (returnJs == 'true' || returnJs == true) {\n    //   properties.text = 'Olá! Seja bem-vindo(a) novamente! 😄'\n    // }\n  }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ... menu.menuScope,\n      \"platform\": platform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ee7f20f2-6581-44e1-99b3-dbb09af51957","$typeOfContent":"","type":"TrackEvent","$title":"quick reply politica oncoclinicas exibicao","$invalid":false,"settings":{"extras":{},"category":"quick reply politica oncoclinicas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7834d7d6-0901-47a7-8f76-9e857ae74938","$typeOfContent":"","type":"TrackEvent","$title":"quick reply politica oncoclinicas selecao","$invalid":false,"settings":{"extras":{},"category":"quick reply politica oncoclinicas selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"cfe5c70b-82e5-495a-8660-9a3a92d3890f","$typeOfContent":"","type":"TrackEvent","$title":"quick reply politica oncoclinicas input inesperado","$invalid":false,"settings":{"extras":{},"category":"quick reply politica oncoclinicas input inesperado","action":"{{input.content}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"3d1427d0-c66c-401a-881d-a0a24d2f50c2","$typeOfContent":"","type":"SetVariable","$title":"privacyPolicy - true","$invalid":false,"settings":{"variable":"privacyPolicy","value":"true"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@input","values":["Sim"]}]},{"$id":"5eaca6c7-e5d3-4488-b214-205878c3a2d5","$typeOfContent":"","type":"TrackEvent","$title":"aceite politica privacidade relatorio","$invalid":false,"settings":{"extras":{},"category":"aceite politica privacidade relatorio","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"f20f9d32-a48c-4b39-a2a6-59b3433cf402","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-ed2ab0b6-d476-fa9f-0ed2-e09dd9fec033","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-4cffa4e2-3244-409f-90a7-9fff4b556eb1","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false}],"id":"e7599a62-7568-4ff4-930e-b51716e74d60","$title":"[BV.1.3.0] [MENU] - Politica de Priv","$position":{"top":"606px","left":"1295px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f80ec11d-a4bc-4632-8af4-86e32ad89c20":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{objMenu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","typeOfStateId":"state","$connId":"con_73","$id":"bae0f186-ad1c-4c77-9020-ded27eca92b5","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"ffc9c039-0c20-4fd7-88e5-ddbd5186ee65","typeOfStateId":"state","$connId":"con_78","$id":"336b73fb-d02b-44e0-a83b-b2242947e8c3","conditions":[{"source":"context","comparison":"equals","values":["Sair","Encerrar","Não","Nao"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n\n  let properties = {\n    'text': `Poxa...😔\\nDessa forma, não conseguirei te ajudar...\\n\\n{{n1}}Deseja continuar aceitando nossos termos de privacidade?{{n2}}`,\n    'options': [\"Sim\", \"Não\"],\n    'values': [\"Sim\", \"Não\"],\n    'description': [],\n    'itens': [\n      { name: ['Sim', 'sim', 's', 'ss', 'yes'] },\n      { name: ['Não', 'nao', 'no', 'n', 'nn', 'nope'] }\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exceção no MENU\n  if (hideInputText == 'true' || hideInputText == true) {\n    properties.text = sentenceOtherMistakesJs + '\\n\\n{{n1}}Deseja continuar aceitando nossos termos de privacidade?{{n2}}'\n  } else {\n    // Exibe mensagem de retorno\n    // if (returnJs == 'true' || returnJs == true) {\n    //   properties.text = 'Olá! Seja bem-vindo(a) novamente! 😄'\n    // }\n  }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = [\n    { name: ['Menu', 'Voltar ao início', 'Reiniciar'] },\n    { name: ['Sair', 'Finalizar', 'Encerrar'] }\n  ]\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objectType = {\n      'type': `text/plain`\n    }\n    return objectType\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ... menu.menuScope,\n      \"platform\": platform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ee7f20f2-6581-44e1-99b3-dbb09af51957","$typeOfContent":"","type":"TrackEvent","$title":"mensagem para ajudar exibicao","$invalid":false,"settings":{"extras":{},"category":"mensagem para ajudar exibicao","action":"Exibicao"},"conditions":[]},{"$id":"70f6a881-545f-44a8-982c-b131560937e0","$typeOfContent":"","type":"TrackEvent","$title":"quick reply comfirmar politica exibicao","$invalid":false,"settings":{"extras":{},"category":"quick reply comfirmar politica exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7834d7d6-0901-47a7-8f76-9e857ae74938","$typeOfContent":"","type":"TrackEvent","$title":"quick reply comfirmar politica selecao","$invalid":false,"settings":{"extras":{},"category":"quick reply comfirmar politica selecao","action":"{{validInputJs@input}}"},"conditions":[]},{"$id":"7ada7392-d912-455f-8396-b1527d5679c2","$typeOfContent":"","type":"TrackEvent","$title":"quick reply comfirmar politica input inesperado","$invalid":false,"settings":{"extras":{},"category":"quick reply comfirmar politica input inesperado","action":"{{input.content}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"01b444aa-49cc-4cdc-80fd-3d2363e1dc62","$typeOfContent":"","type":"TrackEvent","$title":"aceite politica privacidade relatorio","$invalid":false,"settings":{"extras":{},"category":"aceite politica privacidade relatorio","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["success"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"ab02ac53-2265-4711-b224-d4a10c2d7f14","$typeOfContent":"","type":"SetVariable","$title":"privacyPolicy - true","$invalid":false,"settings":{"variable":"privacyPolicy","value":"true"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@input","values":["Sim"]}]},{"$id":"06cf4b99-1cfd-46dd-a134-ee755448559e","$typeOfContent":"","type":"SetVariable","$title":"privacyPolicy - false","$invalid":false,"settings":{"variable":"privacyPolicy","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"validInputJs@input","values":["Não"]}]},{"$id":"a1f8e20c-9e9e-4935-97cc-692fac010eee","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-ed2ab0b6-d476-fa9f-0ed2-e09dd9fec033","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-4cffa4e2-3244-409f-90a7-9fff4b556eb1","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false}],"id":"f80ec11d-a4bc-4632-8af4-86e32ad89c20","$title":"[BV.2.2.0] [MENU] - Política de Priv Não","$position":{"top":"609.429px","left":"1482px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ffc9c039-0c20-4fd7-88e5-ddbd5186ee65":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23db93b0-a85a-41fa-8b51-374afe7e7b68","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#3A4A65","label":"GO TO","id":"blip-tag-2950aeab-5ffc-4bfb-8c0d-5677eb652059","canChangeBackground":false}],"id":"ffc9c039-0c20-4fd7-88e5-ddbd5186ee65","root":false,"$title":"[GO TO] Finalização","$position":{"top":"429.75px","left":"1387.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"5c234a8d-7660-4245-858f-f8867217bdf1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"493e83b7-831c-48d6-93fd-4a1477bc59ff","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$id":"a961affc-6c45-4d13-ab47-86175fe83a28","conditions":[{"source":"context","comparison":"equals","values":["WhatsApp"],"variable":"platform"}],"$invalid":false,"stateId":"cec4de82-b74b-4b7d-9062-ed144a5bd046","$connId":"con_83"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d9d9686-5ee9-4119-9e04-541c87fab188","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"5c234a8d-7660-4245-858f-f8867217bdf1","root":false,"$title":"[Router] Política de Privacidade","$position":{"top":"413px","left":"1065.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff","commentsIdList":[]}},"6c35b2b6-4032-4994-9159-d4228bda3ebf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d7ada577-de41-4e50-9c12-2bfa85cc86ae","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4883"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3b904cac-d437-46b1-8b32-fe2450a423d7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#3A4A65","label":"GO TO","id":"blip-tag-2950aeab-5ffc-4bfb-8c0d-5677eb652059","canChangeBackground":false}],"id":"6c35b2b6-4032-4994-9159-d4228bda3ebf","root":false,"$title":"[GO TO] Menu","$position":{"top":"346px","left":"654px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"042a1341-923f-46d0-bfc4-178c6c4c850f":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{objMenu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c2d57832-450c-44d7-92b2-36d44090afc0","typeOfStateId":"state","$connId":"con_162","$id":"91f8823d-95f0-4e50-b19b-ab291c87fb0d","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"validInputJs@input"}],"$invalid":false},{"stateId":"6215a0d7-5fe1-45be-81d9-d4917556cc0b","typeOfStateId":"state","$connId":"con_167","$id":"b30b87c8-abd2-4a08-a14e-4211779599eb","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"validInputJs@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n\n  let properties = {\n    text: 'Eu sou o Charlie e vou te atender {{n1}}hoje.{{n2}} \\n\\nA última vez que nos falamos, você não me informou todos os seus {{n1}}dados.{{n2}}\\n\\n{{n1}}Vamos continuar seu atendimento?{{n2}}',\n    options: [\"Sim\", \"Não\"],\n    values: [\"Sim\", \"Não\"],\n    description: [],\n    itens: [\n      { name: ['Sim', 'ss', 'claro', 's'] },\n      { name: ['Não', 'nao', 'no', 'n'] },\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exceção no MENU\n  if (hideInputText == 'true' || hideInputText == true) {\n    properties.text = sentenceOtherMistakesJs\n  } else {\n    // Exibe mensagem de retorno\n    // if (returnJs == 'true' || returnJs == true) {\n    //   properties.text = 'Certo! Selecione a seguir como eu posso te ajudar hoje. 👇'\n    // }\n  }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objMenu = {\n      'type': `text/plain`,\n      'content' : geraMenuNumerico(menu)\n    }\n    return objMenu\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ... menu.menuScope,\n      \"platform\": platform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"19b44b1c-95c2-4d6f-be90-4d0f0d3f8a6e","$typeOfContent":"","type":"TrackEvent","$title":"retorno exibicao","$invalid":false,"settings":{"extras":{},"category":"retorno exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"menu retorno selecao","$invalid":false,"settings":{"extras":{},"category":"menu retorno selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"menu retorno inesperado","$invalid":false,"settings":{"extras":{},"category":"menu retorno inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]},{"$id":"7e8a0258-b590-4e06-89f5-389601bc1300","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-34536386-696f-5928-5ea7-4c06b8dfb34e","canChangeBackground":false}],"id":"042a1341-923f-46d0-bfc4-178c6c4c850f","$title":"[R.0.0.0] [MENU] Continuar Atendimento","$position":{"top":"348px","left":"464px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"73640d57-7de2-4a2c-bb10-d13ac05b12bd":{"$contentActions":[{"action":{"$id":"40ccc244-df19-4bf9-a7d1-e4f5f4c46722","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19eb619d-6f11-4923-b326-72ab8352b8ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4649"},{"action":{"$id":"b5a6f654-d2d1-4e03-b68a-1f821b914c28","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{objMenu@type}}","rawContent":"{{objMenu@content}}"}},"$invalid":false,"$$hashKey":"object:4650"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false,"$$hashKey":"object:4651"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0af07bf9-f694-4636-a08b-fc1d339ed605","$typeOfContent":"","type":"ExecuteScript","$title":"inputOptionJs","$invalid":false,"settings":{"function":"run","source":"function run(hideInputText, sentenceOtherMistakesJs, returnJs) {\n\n  let properties = {\n    text: 'Olá {{name}}, que bom que você voltou!  😊\\n\\nA última vez que nos falamos, você me disse que seus dados eram:\\n\\n➡️ E-mail: {{contact.email}}\\n➡️ Número da Reserva: {{contact.extras.Reserva}}\\n\\nEssa informação está correta? ',\n    options: [\"Sim\", \"Não\"],\n    values: [\"Sim\", \"Não\"],\n    description: [],\n    itens: [\n      { name: ['Sim', 'ss', 'claro', 's'] },\n      { name: ['Não', 'nao', 'no', 'n'] },\n    ],\n    menuScope: {\n      \"whatsappButton\": true,\n      \"whatsappList\": false,\n      \"blipchatQuickReply\": false,\n      \"blipchatMenu\": true,\n      \"defaultText\": false\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Exibe mensagem e exceção no MENU\n  if (hideInputText == 'true' || hideInputText == true) {\n    properties.text = sentenceOtherMistakesJs\n  } else {\n    // Exibe mensagem de retorno\n    // if (returnJs == 'true' || returnJs == true) {\n    //   properties.text = 'Certo! Selecione a seguir como eu posso te ajudar hoje. 👇'\n    // }\n  }\n  ////////////////////////////////////////////////////////////////////////////////\n\n  properties.itens = addItensNumeracao(properties.itens);\n\n  // Adição de opções sem numeração\n  let opcoesExtras = []\n\n  opcoesExtras = addItens(opcoesExtras);\n\n  for (let i = 0; i < opcoesExtras.length; i++) {\n    properties.itens.push(opcoesExtras[i]);\n  }\n\n  return JSON.stringify(properties);\n}\n\nfunction addItens(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n  }\n  return newItens;\n}\n\nfunction addItensNumeracao(itens) {\n  let newItens = [];\n  let newNames;\n  let name;\n  let match;\n  for (let i = 0; i < itens.length; i++) {\n    name = itens[i].name;\n    newNames = []\n    for (let y = 0; y < itens[i].name.length; y++) {\n      match = name[y];\n      newNames.push(match);\n      // Adiciona uma variação lowerCase e UpperCase para cada opção do itens\n      newNames.push(match.toLowerCase());\n      newNames.push(match.toUpperCase());\n      newItens[i] = { name: newNames };\n    }\n    newNames.push(`${i + 1}`); // Acrescenta numeração automática\n  }\n  return newItens;\n} \n","inputVariables":["hideInputText","sentenceOtherMistakesJs","return"],"outputVariable":"inputOptionJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"181a73ce-4d24-4c10-90f2-d2e8c352791e","$typeOfContent":"","type":"ExecuteScript","$title":"objMenu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nconst run = (platform, menu) => {\n  menu = JSON.parse(menu);\n  platform = platform.toLowerCase();\n\n  if (platform == 'instagram' || platform == 'messenger') {\n    const objMenu = {\n      'type': `text/plain`,\n      'content' : geraMenuNumerico(menu)\n    }\n    return objMenu\n  };\n\n  let default_msg = {\n    \"text\": menu.text,\n    \"header\": 'Menu',\n    \"body\": menu.text,\n    \"footer\": '',\n    \"button\": 'Menu',\n    \"title\": 'Menu',\n    \"namespaceTemplate\": '',\n    \"nameTemplate\": '',\n    \"options\": menu.options,\n    \"values\": menu.values,\n    \"submenu\": [],\n    \"description\": menu.description,\n    \"menuScope\": {\n      ... menu.menuScope,\n      \"platform\": platform\n    },\n  };\n\n  var newMenu = getMenuForPlatform(default_msg);\n\n  return newMenu;\n};\n\nfunction geraMenuNumerico(menu) {\n  menu = JSON.parse(menu);\n\n  let listaOptions = '\\n\\n';\n  for (let i = 0; i < menu.options.length; i++) {\n    listaOptions = listaOptions + (i + 1) + '. ' + menu.options[i] + '\\n';\n  }\n\n  return menu.text + listaOptions;\n}","inputVariables":["platform","inputOptionJs"],"outputVariable":"objMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"19b44b1c-95c2-4d6f-be90-4d0f0d3f8a6e","$typeOfContent":"","type":"TrackEvent","$title":"retorno exibicao","$invalid":false,"settings":{"extras":{},"category":"retorno exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4c3fd580-c601-45cc-8eae-e805e71a605f","$typeOfContent":"","type":"ExecuteScript","$title":"validInputJs","$invalid":false,"settings":{"function":"run","source":"// ============================================================================\n//      TYPE\n// ============================================================================\n// - reserved => quando há alguma palavra reservada que o bot deverá processar, \n// como SAIR E MENU por exemplo\n// - error => quando alguma validação deverá retornar um erro para cair em exceção\n// - success => quando a validação foi bem sucedida.\n// ============================================================================\n//      INPUT\n// ============================================================================\n// Retorna o input após processamento.\n// - Se type == error => o input será a descrição do erro. Ex: ERRO CEP\n// - Se type == success => o input será o input original processado.\n// ============================================================================\n//      VALIDATION\n// ============================================================================\n// Retorna em qual validação o input foi processado. Ex: cep\n// ============================================================================\n{{resource.FunctionProcessInput}}\n\nfunction run(input, inputType, platform, menu) {\n    try {\n\n        // =================================================================================\n        //             ATENÇÃO: MANIPULAR SOMENTE AS DUAS CONSTANTES A SEGUIR\n        // =================================================================================\n        // - validacaoMenu => true para validação de Menu, false para Input\n        // - validacoesInput => insira aqui que tipo de validação de input vai ser  \n        //   necessário (se mais de um for selecionado, apenas o mais acima será validado)\n        // - erroMenuEspecial => altere somente se, caso a validação seja um Menu e para\n        //   este menu haja um tratamento diferente de exceção.\n        // =================================================================================\n        const validacaoMenu = true;\n        const erroMenuEspecial = 'ERRO DINAMICO';\n        const validacoesInput = {\n            primeiroNome: false,\n            nomeCompleto: false,\n            email: false,\n            telefone: false,\n            cep: false,\n            data: false,\n            img: false,\n            imgTxt: false,\n            endereco: false,\n            moeda: false,\n            cpf: false,\n            cnpj: false,\n            cpfcnpj: false\n        };\n        // ========================================================================\n\n        // Inicia o objeto que será retornado pela função\n        let processedInput = {\n            'type': null,\n            'input': null,\n            'validation': 'none'\n        }\n\n        // Verifica se o usuário digitou SAIR ou MENU\n        // if (input == 'sair' || input == 'SAIR' || input == 'Sair') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'SAIR'\n        //     return JSON.stringify(processedInput)\n        // } else if (input == 'menu' || input == 'MENU' || input == 'Menu') {\n        //     processedInput.type = 'reserved'\n        //     processedInput.input = 'MENU'\n        //     return JSON.stringify(processedInput)\n        // }\n\n        // Formata variáveis\n        menu = JSON.parse(menu);\n        platform = platform.toUpperCase()\n\n        if (validacaoMenu) {\n            // Validação de MENU\n            processedInput = validaMenu(input, menu, platform)\n\n            // Verifica se precisa mudar a mensagem de erro do Menu Dinâmico para o Especial\n            if ((processedInput.input == 'ERRO DINAMICO' || processedInput.input == 'ERRO NUMERICO') && erroMenuEspecial != '') {\n                processedInput.input = erroMenuEspecial; \n            }\n            return JSON.stringify(processedInput);\n\n        } else {\n            // Validação de INPUT\n            const val = Object.entries(validacoesInput);\n            processedInput = validaInput(val, input, inputType)\n\n            // Se nenhuma validação foi processada, retorna o input sem validação\n            if (processedInput.input == 'INPUT SEM VALIDAÇÕES') {\n                return JSON.stringify({type: 'success', input: input, validation: 'none'});\n\n            } else {\n                return JSON.stringify(processedInput);\n            }\n        }\n\n    } catch (e) {\n        return {type: 'error', input: 'ERRO INESPERADO', validation: 'none'}\n    }\n}","inputVariables":["input.content","input.type","platform","inputOptionJs"],"outputVariable":"validInputJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ca0780fb-4590-4991-b281-fda1d115b2b6","$typeOfContent":"","type":"TrackEvent","$title":"menu retorno selecao","$invalid":false,"settings":{"extras":{},"category":"menu retorno selecao","action":"{{validInputJs@input}}"},"conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"validInputJs@type"},{"source":"input","comparison":"exists","values":[]}]},{"$id":"66155932-cd0b-4c34-9628-39d25d459551","$typeOfContent":"","type":"TrackEvent","$title":"menu retorno inesperado","$invalid":false,"settings":{"extras":{},"category":"menu retorno inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"validInputJs@type","values":["error","reserved"]}]},{"$id":"7e8a0258-b590-4e06-89f5-389601bc1300","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"background":"#FF6F1E","label":"executeScript","id":"blip-tag-df3af129-53bb-ec72-481d-85ae1c73cfe0","canChangeBackground":false},{"background":"#FFEC03","label":"userInput","id":"blip-tag-59565120-de68-cdcc-653c-94c14e2b5e9e","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-34536386-696f-5928-5ea7-4c06b8dfb34e","canChangeBackground":false}],"id":"73640d57-7de2-4a2c-bb10-d13ac05b12bd","$title":"[R.0.0.0] [MENU] Confirma Dados","$position":{"top":"347px","left":"267px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c2d57832-450c-44d7-92b2-36d44090afc0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b55f6aa-8e8f-4f70-b27e-1d3c8cb1d71c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0b145b5b-64d4-43da-aa91-75b8b383c94d","$typeOfContent":"","type":"SetVariable","$title":"returnException","$invalid":false,"settings":{"variable":"returnException","value":"true"},"conditions":[]},{"$id":"3d0a7d54-4750-497c-9a03-d0216f904d73","$typeOfContent":"","type":"SetVariable","$title":"target service","$invalid":false,"settings":{"variable":"targetService","value":"{{ultimoBlocoOndeParou@service}}"},"conditions":[]},{"$id":"3cdf1ee3-049d-494a-98a2-6d0af5ee668e","$typeOfContent":"","type":"SetVariable","$title":"exception","$invalid":false,"settings":{"variable":"exception","value":"{{ultimoBlocoOndeParou@exception}}"},"conditions":[]},{"$id":"03b59b14-7cfd-4a4d-9433-b0c6e3f151b6","$typeOfContent":"","type":"SetVariable","$title":"ultimoBlocoOndeParou [clear]","$invalid":false,"settings":{"variable":"ultimoBlocoOndeParou"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f1a3443f-dc78-4994-9cef-d2220f970f42","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Bloco","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{targetService}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-f0773d70-1b65-17d8-0513-88aa4e892421","canChangeBackground":false},{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-d2fad23e-0ffd-4ff0-98c5-c3845d204031","canChangeBackground":false}],"id":"c2d57832-450c-44d7-92b2-36d44090afc0","root":false,"$title":"[REDIRECT TO] Último Bloco","$position":{"top":"502px","left":"462px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}},"6215a0d7-5fe1-45be-81d9-d4917556cc0b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d7ada577-de41-4e50-9c12-2bfa85cc86ae","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:5040"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23db93b0-a85a-41fa-8b51-374afe7e7b68","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#3A4A65","label":"GO TO","id":"blip-tag-2950aeab-5ffc-4bfb-8c0d-5677eb652059","canChangeBackground":false}],"id":"6215a0d7-5fe1-45be-81d9-d4917556cc0b","root":false,"$title":"[GO TO] Finalização","$position":{"top":"632px","left":"464px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"15916985-02e7-4b57-bb99-afa74b5eaaa7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"be996d59-606a-485c-bd73-cb31970b6f66","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4125"}],"$conditionOutputs":[{"stateId":"042a1341-923f-46d0-bfc4-178c6c4c850f","typeOfStateId":"state","$connId":"con_182","$id":"ed95d57d-d966-4df5-ba03-272cce5ee213","conditions":[{"source":"context","comparison":"equals","values":["dados ausentes"],"variable":"validaRetorno","$$hashKey":"object:4242"}],"$invalid":false,"$$hashKey":"object:4232"},{"stateId":"6c35b2b6-4032-4994-9159-d4228bda3ebf","typeOfStateId":"state","$connId":"con_187","$id":"73c9b7cd-59ea-4287-bb61-0d8d97871d16","conditions":[{"source":"context","comparison":"equals","values":["dados ausentes: sem bloco onde parou"],"variable":"validaRetorno","$$hashKey":"object:4254"}],"$invalid":false,"$$hashKey":"object:4233"},{"stateId":"73640d57-7de2-4a2c-bb10-d13ac05b12bd","typeOfStateId":"state","$connId":"con_192","$id":"b5a00338-f8b7-4fda-94fc-2cb48567fe69","conditions":[{"source":"context","comparison":"equals","values":["dados completos"],"variable":"validaRetorno","$$hashKey":"object:4266"}],"$invalid":false,"$$hashKey":"object:4234"}],"$enteringCustomActions":[{"$id":"6146ae07-d367-4b08-9daa-f2a8e356a3fc","$typeOfContent":"","type":"TrackEvent","$title":"retorno Exibicao","$invalid":false,"settings":{"extras":{},"category":"retorno Exibicao","action":"Exibicao"},"conditions":[{"source":"input","comparison":"exists","values":[]}]}],"$leavingCustomActions":[{"$id":"76f9df67-5706-47f9-baa2-6f6c173a6452","$typeOfContent":"","type":"SetVariable","$title":"hideInputText [false]","$invalid":false,"settings":{"variable":"hideInputText","value":"false"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6c35b2b6-4032-4994-9159-d4228bda3ebf","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-c54b55c8-285f-be44-167f-ddb9370efbe9","canChangeBackground":false},{"id":"blip-tag-d2fad23e-0ffd-4ff0-98c5-c3845d204031","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"15916985-02e7-4b57-bb99-afa74b5eaaa7","$title":"[R.1.0.0] Retorno [ultimo bloco]","$position":{"top":"205px","left":"466px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff","commentsIdList":[]}}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}