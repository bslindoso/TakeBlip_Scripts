{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c6fde1c4-1481-4d06-ad78-0804bbf76a92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$connId":"con_3","$invalid":false,"$id":"35d42520-8a51-4415-83eb-c220e382bdeb","typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c6fde1c4-1481-4d06-ad78-0804bbf76a92","$invalid":false,"typeOfStateId":"state"},"id":"onboarding","root":true,"$position":{"top":"38px","left":"389px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[]},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0a53ade3-d1bb-4793-9cf6-0055bf68ab2a","typeOfStateId":"state","$connId":"con_8","$id":"f881585b-aa9f-46d8-9786-e5d3b59ca872","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"0a53ade3-d1bb-4793-9cf6-0055bf68ab2a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$connId":"con_13","$invalid":false,"$id":"61d23b1d-0f2a-481a-8554-9551b2c3fcb9","typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"90a5e836-dc7d-487d-b736-66543e28fc0d","$typeOfContent":"","type":"ExecuteScript","$title":"exception","$invalid":false,"settings":{"function":"run","source":"function run(previousState, typeInput) {\n    let idFormated = previousState.split(\" \")\n    idFormated = idFormated[0].replace(\"[\",\"\").replace(\"]\",\"\")\n    const exception = {\n        id: `${idFormated}`,\n        input: '{{input.content}}',\n        redirectMenu: typeInput\n    }\n\n\n    return exception\n}","inputVariables":["state.previous.name","validInputJs"],"outputVariable":"exception","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","$position":{"top":"16px","left":"1408px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#FF961E","label":"executeScript","id":"blip-tag-a1578857-f2c5-9986-b4db-67b36b5956a3","canChangeBackground":false}]},"desk:b69ef3a2-9983-48f8-9d40-16bad478a460":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b04c3ac0-5b0c-4f61-ade4-9adbd31ae1fc","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false,"expiration":"2:0"},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"9246bdf4-fb98-49ff-a094-db97fd381a1e","$connId":"con_18","$id":"fec13811-ae23-4a84-9b95-48797852a14d"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"9246bdf4-fb98-49ff-a094-db97fd381a1e","$connId":"con_23","$id":"1f73d79b-1c17-4afd-b8f0-a46d516e9133"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"9753b927-d8ab-444a-b996-02459c301f32","$connId":"con_28","$id":"d8139e7e-144b-44ce-b2d4-3ee87cba01fb"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"GetEncodedContactIdentity","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"function":"run","source":"function run(identity) {\n return (identity !== undefined) ? encodeURIComponent(identity) : identity;\n}","inputVariables":["input.message.fromidentity"],"outputVariable":"helpDeskEncodedFromIdentity","LocalTimeZoneEnabled":false}},{"type":"ProcessCommand","$title":"GetOpenTicket","conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"get","uri":"/tickets?$filter=customerIdentity%20eq%20%27{{helpDeskEncodedFromIdentity}}%27%20and%20%28status%20eq%20%27Open%27%20or%20status%20eq%20%27Waiting%27%20or%20status%20eq%20%27Assigned%27%29","variable":"helpDeskGetOpenTicketCommandResponse"},"$invalid":false},{"type":"ExecuteScript","$title":"TreatGetOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = JSON.parse(commandResponse)\n    var ticketExists = (response && response.resource && response.resource.items && response.resource.items.length > 0);\n  return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskGetOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"type":"ProcessCommand","$title":"OpenTicketIfNotFound","conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"set","uri":"/tickets/{{helpDeskEncodedFromIdentity}}","variable":"helpDeskOpenTicketCommandResponse","type":"text/plain","resource":"{{input.content}}","metadata":{"server.shouldStore":true}},"$invalid":false},{"type":"ExecuteScript","$title":"TreatOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = commandResponse ? JSON.parse(commandResponse) : {}\n    var ticketExists = response && response.type === \"application/vnd.iris.ticket+json\" && response.resource \n    return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"type":"ForwardMessageToDesk","settings":{},"$invalid":false}],"$leavingCustomActions":[{"type":"SetVariable","$title":"ResetHasTicket","settings":{"$invalid":false,"variable":"helpDeskHasTicket","value":"false"},"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant","ClosedClient","ClosedClientInactivity"]}],"$invalid":false}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$invalid":false},"id":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","deskStateVersion":"2.0.1","root":false,"$title":"Atendimento humano","$position":{"top":"854px","left":"384px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#0d47a1","textColor":"#ffffff"}},"ea376d2d-7e6e-45e3-b5b3-3c0d713e7b11":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"71666f38-879c-488e-bd29-5593e19aae4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"65d944f7-4106-4315-8b5e-967f690dfae9","$typeOfContent":"","type":"Redirect","$title":"[GO TO] NOTA","$invalid":false,"settings":{"context":{"type":"text/plain","value":"nota"},"address":"{{serviceList@nota}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-180bb99d-115a-1424-84e0-1190407e09c0","canChangeBackground":false}],"id":"ea376d2d-7e6e-45e3-b5b3-3c0d713e7b11","root":false,"$title":"[GO TO] Nota","$position":{"top":"147px","left":"1607px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"9753b927-d8ab-444a-b996-02459c301f32":{"$contentActions":[{"action":{"$id":"3c18348a-725d-41f7-9ac6-0561efe36dab","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a6a2203f-29c0-44b4-adb6-d2b8831a770a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a6a2203f-29c0-44b4-adb6-d2b8831a770a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"609d5e1b-6140-47a5-b087-623cdf764ad4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6298d58b-6bf5-4c5f-8fd4-03b348525de0","type":"text/plain","content":"Como você ficou 30min sem nos responder, estamos encerrando seu atendimento por inatividade. ☑️\n\nCaso queira um novo atendimento, basta enviar uma mensagem nessa mesma conversa. 😊","metadata":{}},"$cardContent":{"document":{"id":"6298d58b-6bf5-4c5f-8fd4-03b348525de0","type":"text/plain","content":"Como você ficou 30min sem nos responder, estamos encerrando seu atendimento por inatividade. ☑️\n\nCaso queira um novo atendimento, basta enviar uma mensagem nessa mesma conversa. 😊"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a527de49-507e-4a85-86df-0f2139d60056","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"e2e403e5-f15e-4d29-9844-745ec9fcdf4e","$typeOfContent":"","type":"TrackEvent","$title":"encerramento inatividade exibicao","$invalid":false,"settings":{"extras":{},"category":"encerramento inatividade exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"291a0834-bc59-4901-b1a0-ea37ab2601c7","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"inatividade"},"address":"{{serviceList@finalizacao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-71cc8925-4712-543a-feb5-058475fd59db","canChangeBackground":false}],"id":"9753b927-d8ab-444a-b996-02459c301f32","root":false,"$title":"Inatividade","$position":{"top":"1003px","left":"171px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"c6fde1c4-1481-4d06-ad78-0804bbf76a92":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dbe0f7fa-9ba6-450f-89eb-d8029824743b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eeeff199-2280-44bc-b0d4-46a0729ca89a","typeOfStateId":"state","$connId":"con_33","$id":"6e2ed3fb-25ae-4329-a337-ca9e8aa7ecf1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cd2a17cd-740c-4c7f-8775-69b6c6c6545e","$typeOfContent":"","type":"SetVariable","$title":"service","$invalid":false,"settings":{"variable":"service","value":"sctransbordo"},"conditions":[]},{"$id":"2b94ab8e-d556-4a91-a5e5-9b181982730a","$typeOfContent":"","type":"ProcessHttp","$title":"GET Waiting Tickets","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n    \"id\": \"{{$guid}}\",\n    \"to\": \"postmaster@desk.msging.net\",\n    \"method\": \"get\",\n    \"uri\": \"/monitoring/tickets\"\n}","uri":"{{config.urlBlip}}","responseStatusVariable":"statusWaiting","responseBodyVariable":"responseWaiting"},"conditions":[]},{"$id":"8c3f9622-2714-4bd7-b121-eaaba67daf6f","$typeOfContent":"","type":"ProcessHttp","$title":"GET Online Attendant","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n   \"id\": \"{{$guid}}\",\n   \"to\": \"postmaster@desk.msging.net\",\n   \"method\": \"get\",\n   \"uri\": \"/attendants\"\n }","uri":"{{config.urlBlip}}","responseStatusVariable":"statusOnlineAttendant","responseBodyVariable":"responseOnlineAttendant"},"conditions":[]},{"$id":"c9e44f54-988f-482f-84a3-cee3a421f1ca","$typeOfContent":"","type":"MergeContact","$title":"Time","$invalid":false,"settings":{"extras":{"Team":"Fila Unica"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF961E","label":"executeScript","id":"blip-tag-a1578857-f2c5-9986-b4db-67b36b5956a3","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-0b488f20-3494-a80c-e63c-d05d80fe4a4a","canChangeBackground":false},{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-6e13007c-716c-6d50-68aa-0efb8b4afb47","canChangeBackground":false}],"id":"c6fde1c4-1481-4d06-ad78-0804bbf76a92","$title":"[REQUIREMENTS]","$position":{"top":"141px","left":"388px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff"}},"a4425c36-b361-4363-97cc-0bb558f88edf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Finalizar","$invalid":false,"settings":{"context":{"type":"text/plain","value":"finalizacao"},"address":"{{serviceList@finalizacao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-180bb99d-115a-1424-84e0-1190407e09c0","canChangeBackground":false}],"id":"a4425c36-b361-4363-97cc-0bb558f88edf","root":false,"$title":"[REDIRECT TO] Finalizar","$position":{"top":"260px","left":"1606px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"0a53ade3-d1bb-4793-9cf6-0055bf68ab2a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f4a76ec3-f892-4cad-ad43-60297c09eb7b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3fb7ef00-299c-4276-8405-acb5cf3a78a4","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Exceções","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{exception}}"},"address":"{{serviceList@excecao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-180bb99d-115a-1424-84e0-1190407e09c0","canChangeBackground":false}],"id":"0a53ade3-d1bb-4793-9cf6-0055bf68ab2a","$title":"[REDIRECT TO] Exceções","$position":{"top":"15px","left":"1606px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000"}},"9246bdf4-fb98-49ff-a094-db97fd381a1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"77651b7b-346e-4277-8d19-4cfa5f84b06b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"addd8fd2-1f30-4774-96b8-17dc3bdf2eda","typeOfStateId":"state","$connId":"con_38","$id":"8feb250b-faeb-4d97-a770-7720ce20d851","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"32b48d03-32d0-4f5b-94a8-1a10c85edd16","type":"ExecuteScript","$title":"Get agentIdentity","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    let ticketData = JSON.parse(input);\n    return encodeURI(ticketData.agentIdentity);\n}\n","inputVariables":["input.content"],"outputVariable":"agentIdentity","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ff1d7797-15b2-4904-8366-88e29ace31c7","$typeOfContent":"","type":"ProcessHttp","$title":"Agent Data","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n  \"id\": \"db42d9df-a77e-42cf-9e17-9d97213eda47\",\n  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/attendants?$filter=(identity%20eq%20'{{agentidentity}}')\"\n}","uri":"https://msging.net/commands","responseStatusVariable":"statusAgentData","responseBodyVariable":"agentData"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"agentIdentity"}]},{"$id":"7994a4ad-c51e-4e4b-944d-9730de6d4f67","type":"ExecuteScript","$title":"Get agentName","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try{\n        let agenteId = JSON.parse(input);\n        return agenteId.resource.items[0].fullName;\n    } \n    catch(e)\n    {\n        return \"\";\n    }\n}","inputVariables":["agentData"],"outputVariable":"agentName","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c6413aa4-9998-44d3-b5c0-b07e21389031","$typeOfContent":"","type":"SetVariable","$title":"Ticket ID","$invalid":false,"settings":{"variable":"ticket","value":"{{input.content@sequentialId}}"},"conditions":[]},{"$id":"6a0e22b4-b0b7-4f14-bcc9-ff09055cfdc0","$typeOfContent":"","type":"ExecuteScript","$title":"Tag Atendimento","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\n    inputContent = JSON.parse(inputContent)\n\n    if (inputContent.hasOwnProperty(\"tags\")) {\n        let tags = inputContent.tags;\n        return JSON.stringify(tags)\n    } else {\n        return \"[]\"\n    }\n}","inputVariables":["input.content"],"outputVariable":"tagatendimento","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"addd8fd2-1f30-4774-96b8-17dc3bdf2eda"},"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false},{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false}],"id":"9246bdf4-fb98-49ff-a094-db97fd381a1e","root":false,"$title":"Informação Atendimento","$position":{"top":"1078px","left":"385px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true,"addonsSettings":{"backgroundColor":"#f06292","textColor":"#000000"}},"addd8fd2-1f30-4774-96b8-17dc3bdf2eda":{"$contentActions":[{"action":{"$id":"33dc68fc-4b13-40c2-b0b5-7db20015574f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bd9ec309-499c-4ca6-a5f2-beeef3796bdd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bd9ec309-499c-4ca6-a5f2-beeef3796bdd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2951ab09-7a7b-4f02-b593-6235e5708e47","$typeOfContent":"text","type":"SendMessage","settings":{"id":"13b6d242-d5d8-422e-a5a1-8750dd4a837d","type":"text/plain","content":"Obrigado por entrar em contato, o seu atendimento foi encerrado. ✅\n\nCaso queira um {{n1}}novo atendimento{{n2}}, basta enviar uma mensagem nessa mesma conversa. 😊","metadata":{}},"$cardContent":{"document":{"id":"13b6d242-d5d8-422e-a5a1-8750dd4a837d","type":"text/plain","content":"Obrigado por entrar em contato, o seu atendimento foi encerrado. ✅\n\nCaso queira um {{n1}}novo atendimento{{n2}}, basta enviar uma mensagem nessa mesma conversa. 😊"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1fc232be-dfa0-4ecb-a3f8-614ccf9bf9e8","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"385e806b-adc1-42b3-81ae-1d0c4435df9a","$typeOfContent":"","type":"TrackEvent","$title":"finalizacao atendimento exibicao","$invalid":false,"settings":{"extras":{},"category":"finalizacao atendimento exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ea376d2d-7e6e-45e3-b5b3-3c0d713e7b11","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-71cc8925-4712-543a-feb5-058475fd59db","canChangeBackground":false}],"id":"addd8fd2-1f30-4774-96b8-17dc3bdf2eda","root":false,"$title":"[T.0.0.4] Atendimento Encerrado","$position":{"top":"1219px","left":"379px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"427e4798-f475-4a5d-ac9b-2755c6687d01":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dbe0f7fa-9ba6-450f-89eb-d8029824743b","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"cd2a17cd-740c-4c7f-8775-69b6c6c6545e","$typeOfContent":"","type":"SetVariable","$title":"service","$invalid":false,"settings":{"variable":"service","value":"sactransbordo"},"conditions":[]},{"$id":"8d8cbd18-d687-4b88-b8eb-f501c9ec5d86","$typeOfContent":"","type":"SetVariable","$title":"team - outros assuntos","$invalid":false,"settings":{"variable":"team"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"team"},{"source":"context","comparison":"equals","variable":"team","values":["Outros Assuntos"]}]},{"$id":"55a837f9-800b-4b75-9d66-3c2a35d7aa41","$typeOfContent":"","type":"MergeContact","$title":"Set contact","$invalid":false,"settings":{"extras":{"team":"{{team}}","nome":"{{nomeCompleto}}","telefone":"{{phone}}"}},"conditions":[]},{"$id":"491401ee-410f-4309-ba51-37c6309634e8","$typeOfContent":"","type":"ProcessCommand","$title":"Merge das Informações extras","$invalid":false,"settings":{"to":"postmaster@msging.net","method":"merge","resource":"{\"identity\":\"{{tunnel.identity}}\",\"source\":\"{{contact.source}}\",\"extras\":{\"team\":\"{{team}}\",\"nome\":\"{{nome}}\",\"Telefone\":\"{{telefone}}\"}}","type":"application/vnd.lime.contact","uri":"/contacts","variable":"statusMergeContact"},"conditions":[]},{"$id":"ab9663cb-fa6f-4a6b-9264-ec2ead9cc485","$typeOfContent":"","type":"ExecuteScript","$title":"bodyExtrasJs","$invalid":false,"settings":{"function":"run","source":"function run(contact, id){\n    obj = JSON.parse(contact)\n    obj.identity = id\n\n    request = {\n        \"id\": \"{{$guid}}\",\n        \"method\": \"set\",\n        \"uri\": \"/contacts\",\n        \"type\": \"application/vnd.lime.contact+json\",\n        \"resource\": obj\n    }\n    return request\n}","inputVariables":["contact.serialized","tunnel.identity"],"outputVariable":"bodyExtrasJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"da6ae3dd-a400-4051-9a62-0c693a67fc70","$typeOfContent":"","type":"ProcessHttp","$title":"updateExtras","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{{bodyExtrasJs}}","uri":"{{config.urlBlip}}","responseStatusVariable":"statusUpdateExtras","responseBodyVariable":"responseUpdateExtras"},"conditions":[]},{"$id":"2b94ab8e-d556-4a91-a5e5-9b181982730a","$typeOfContent":"","type":"ProcessHttp","$title":"GET Waiting Tickets","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n    \"id\": \"{{$guid}}\",\n    \"to\": \"postmaster@desk.msging.net\",\n    \"method\": \"get\",\n    \"uri\": \"/monitoring/tickets\"\n}","uri":"{{config.urlBlip}}","responseStatusVariable":"statusWaiting","responseBodyVariable":"responseWaiting"},"conditions":[]},{"$id":"8c3f9622-2714-4bd7-b121-eaaba67daf6f","$typeOfContent":"","type":"ProcessHttp","$title":"GET Online Attendant","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n   \"id\": \"{{$guid}}\",\n   \"to\": \"postmaster@desk.msging.net\",\n   \"method\": \"get\",\n   \"uri\": \"/attendants\"\n }","uri":"{{config.urlBlip}}","responseStatusVariable":"statusOnlineAttendant","responseBodyVariable":"responseOnlineAttendant"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF961E","label":"executeScript","id":"blip-tag-a1578857-f2c5-9986-b4db-67b36b5956a3","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-0b488f20-3494-a80c-e63c-d05d80fe4a4a","canChangeBackground":false},{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-6e13007c-716c-6d50-68aa-0efb8b4afb47","canChangeBackground":false}],"id":"427e4798-f475-4a5d-ac9b-2755c6687d01","$title":"[REQUIREMENTS] [EXTRAS UPDATE]","$position":{"top":"0px","left":"1941px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#000000","textColor":"#ffffff","commentsIdList":[]}},"ca7c9e67-0aeb-4c85-a742-6ab75c8647b9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8e4ac08d-0d72-4f9e-a173-90d5e8aec6dd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"ca7c9e67-0aeb-4c85-a742-6ab75c8647b9","root":false,"$title":"Atendimento humano com sair","$position":{"top":"0.25px","left":"2159.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#455a64","textColor":"#ffffff"}},"29e68ab7-20c6-4af9-8c82-3c5496d3d0fe":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2408e195-b7d8-4066-9814-0615f894c32f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8d05636a-968f-4d8d-a902-8f9347d0879b","$typeOfContent":"","type":"SetVariable","$title":"ticketId","$invalid":false,"settings":{"variable":"ticketId","value":"{{helpdeskopenticketcommandresponse@resource.id}}"},"conditions":[]},{"$id":"833b5974-8de4-4f95-be6b-7026f5dc4720","$typeOfContent":"","type":"ProcessHttp","$title":"Change Status","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{config.token}}"},"method":"POST","body":"{\n    \"id\": \"{{$guid}}\",\n    \"to\": \"postmaster@desk.msging.net\",\n    \"method\": \"set\",\n    \"uri\": \"/tickets/change-status\",\n    \"type\": \"application/vnd.iris.ticket+json\",\n    \"resource\": {\n        \"id\": \"{{ticketId}}\",\n        \"status\": \"ClosedClient\"\n    }\n}","uri":"https://ccrriosp.http.msging.net/commands","responseStatusVariable":"statusClose","responseBodyVariable":"responseClose"},"conditions":[]},{"$id":"78b1a880-3f31-47a9-983a-41b1b8a3876d","$typeOfContent":"","type":"ProcessHttp","$title":"Fechar Ticket","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n    \"id\": \"44ffea8b-2a9a-43bb-b6e0-617c17955f4e\",\n    \"method\": \"set\",\n    \"to\": \"postmaster@desk.msging.net\",\n    \"uri\": \"/tickets/{{ticketId}}/close\",\n    \"type\": \"application/vnd.iris.ticket+json\",\n    \"resource\": {\n        \"closedBy\": \"agent%40email.net@blip.ai\",\n        \"tags\": [\n            \"Encerrado pelo Cliente\"\n        ]\n    }\n}","uri":"https://ccrriosp.http.msging.net/commands","responseStatusVariable":"fecharTicketStatus","responseBodyVariable":"fecharTicketResponse"},"conditions":[]},{"$id":"68371608-82da-4584-97ed-65b0a141871e","$typeOfContent":"","type":"MergeContact","$title":"Team [reset]","$invalid":false,"settings":{"extras":{"Team":"-"}},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.Equipe"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false}],"id":"29e68ab7-20c6-4af9-8c82-3c5496d3d0fe","root":false,"$title":"Close a Ticket as a user [API]","$position":{"top":"190.667px","left":"1949.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#f06292","textColor":"#000000","commentsIdList":[]}},"321bbef2-eb62-4ec6-b36a-fe80f0e1a400":{"$contentActions":[{"action":{"$id":"e955887e-a7ae-47b5-b9e4-0564d167e678","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"826406d8-a632-4cff-b54c-dbadbf4ee16b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"826406d8-a632-4cff-b54c-dbadbf4ee16b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a2306aaf-43ca-4f22-9557-734fba73e435","$typeOfContent":"text","type":"SendMessage","settings":{"id":"070a4f39-cc1c-44d3-bd02-daedb1bd159b","type":"text/plain","content":"Atendimento finalizado!","metadata":{}},"$cardContent":{"document":{"id":"070a4f39-cc1c-44d3-bd02-daedb1bd159b","type":"text/plain","content":"Atendimento finalizado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e08080e-afb9-45a4-b58c-0c42cd9544cf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"321bbef2-eb62-4ec6-b36a-fe80f0e1a400","root":false,"$title":"Finalizar Atendimento Example","$position":{"top":"210.5px","left":"2167.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c63fc9a4-917a-44fb-bf46-1707b9e8d4db":{"$contentActions":[{"action":{"$id":"79acc106-b326-483b-ba72-e82238b3ae20","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"afbe79cb-a0ce-41eb-919f-98f4ab6815af","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"afbe79cb-a0ce-41eb-919f-98f4ab6815af","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fced2723-a4b6-4271-82ec-11a0d9ab338d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9b1ed325-2104-42f7-88dc-5bc6579bfcc1","type":"text/plain","content":"Seu atendimento foi encerrado por {{n1}}inatividade{{n2}}.","metadata":{}},"$cardContent":{"document":{"id":"9b1ed325-2104-42f7-88dc-5bc6579bfcc1","type":"text/plain","content":"Seu atendimento foi encerrado por {{n1}}inatividade{{n2}}."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ea258376-ef00-487d-a287-fed778335f17","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"c63fc9a4-917a-44fb-bf46-1707b9e8d4db","root":false,"$title":"Inatividade Example","$position":{"top":"110.75px","left":"2361.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:27177e95-415a-4237-996e-149269b134b8":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"$cardContent":{"document":{"id":"d12a529f-2c9f-44f7-8c66-4546fcbff12a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"29e68ab7-20c6-4af9-8c82-3c5496d3d0fe","typeOfStateId":"state","$connId":"con_43","$id":"a65a5d36-2e6b-4d78-ad47-8a9a11994e35","conditions":[{"source":"input","comparison":"contains","values":["Cancelar consulta"]}],"$invalid":false},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"321bbef2-eb62-4ec6-b36a-fe80f0e1a400","$connId":"con_48","$id":"3498ccfd-12b6-4348-a78a-41f6f23cf90a"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"321bbef2-eb62-4ec6-b36a-fe80f0e1a400","$connId":"con_53","$id":"4fe8edfd-10b6-4039-b168-1bfcfb195580"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"c63fc9a4-917a-44fb-bf46-1707b9e8d4db","$connId":"con_58","$id":"ba286730-b057-45f0-8a78-b5385507e251"}],"$enteringCustomActions":[{"$id":"74e1bb96-e91f-47fb-b017-81944a87334e","$typeOfContent":"","type":"ExecuteScript","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:8d8d079e-0173-4af2-bcf1-28050e50baa9"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"function":"run","source":"function run(contact, tunnel_identity) {\n    contact = JSON.parse(contact);\n    contact.identity = tunnel_identity;\n    return contact;\n}","inputVariables":["contact.serialized","tunnel.identity"],"outputVariable":"deskUpdateTunnelContactBody","LocalTimeZoneEnabled":false}},{"$id":"4795a4dd-408c-472d-b72c-dc8dcc493fb2","$typeOfContent":"","type":"ProcessCommand","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:8d8d079e-0173-4af2-bcf1-28050e50baa9"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"to":"postmaster@msging.net","from":"{{application.identity}}","method":"merge","uri":"/contacts","type":"application/vnd.lime.contact+json","resource":"{{deskUpdateTunnelContactBody}}","variable":"mergeRouterContactWithTunnelCommandResponse"}},{"$id":"39680e04-8d96-4b2c-abe3-3c735458efd0","$typeOfContent":"","type":"ExecuteScript","$title":"GetEncodedContactIdentity","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:8d8d079e-0173-4af2-bcf1-28050e50baa9"]}],"settings":{"function":"run","source":"function run(identity) {\n return (identity !== undefined) ? encodeURIComponent(identity) : identity;\n}","inputVariables":["input.message.fromidentity"],"outputVariable":"helpDeskEncodedFromIdentity","LocalTimeZoneEnabled":false}},{"$id":"61c26e40-ae30-4175-8cf1-c9a4041ecd92","$typeOfContent":"","type":"ProcessCommand","$title":"GetOpenTicket","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:8d8d079e-0173-4af2-bcf1-28050e50baa9"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"get","uri":"/tickets?$filter=customerIdentity%20eq%20%27{{helpDeskEncodedFromIdentity}}%27%20and%20%28status%20eq%20%27Open%27%20or%20status%20eq%20%27Waiting%27%20or%20status%20eq%20%27Assigned%27%29","metadata":{"server.shouldStore":true},"variable":"helpDeskGetOpenTicketCommandResponse"}},{"$id":"b99fddcb-f0ca-4c45-b7fd-46fbffab59a2","$typeOfContent":"","type":"ExecuteScript","$title":"TreatGetOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:8d8d079e-0173-4af2-bcf1-28050e50baa9"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = JSON.parse(commandResponse)\n    var ticketExists = (response && response.resource && response.resource.items && response.resource.items.length > 0);\n  return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskGetOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"7ab26d4b-5bd1-4534-b504-eb544cb9a47b","$typeOfContent":"","type":"ProcessCommand","$title":"OpenTicketIfNotFound","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"set","uri":"/tickets/{{helpDeskEncodedFromIdentity}}","variable":"helpDeskOpenTicketCommandResponse","type":"text/plain","resource":"{{input.content}}","metadata":{"server.shouldStore":true}}},{"$id":"577696ac-f6ac-453d-91e1-8ad5ed263f68","$typeOfContent":"","type":"ExecuteScript","$title":"TreatOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = commandResponse ? JSON.parse(commandResponse) : {}\n    var ticketExists = response && response.type === \"application/vnd.iris.ticket+json\" && response.resource \n    return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"330c4a15-64d9-4951-a940-659c536a51fc","$typeOfContent":"","type":"ForwardMessageToDesk","conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"settings":{},"$invalid":false}],"$leavingCustomActions":[{"$id":"46834bd2-9dbe-4d60-aef5-95776d886545","$typeOfContent":"","type":"SetVariable","$title":"ResetHasTicket","$invalid":false,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant","ClosedClient","ClosedClientInactivity"]}],"settings":{"variable":"helpDeskHasTicket","value":"false","$invalid":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:27177e95-415a-4237-996e-149269b134b8","$invalid":false},"$tags":[],"id":"desk:27177e95-415a-4237-996e-149269b134b8","deskStateVersion":"2.00","root":false,"$title":"Atendimento humano","$position":{"top":"108.5px","left":"2162.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eeeff199-2280-44bc-b0d4-46a0729ca89a":{"$contentActions":[{"action":{"$id":"85e83a14-be51-4d6f-8686-e1acaf4ad38b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2a1afa1b-19f3-4a27-bc51-4a31b2638342","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2a1afa1b-19f3-4a27-bc51-4a31b2638342","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f7941089-9847-41ac-bafd-9199bbe743f3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e94cd9bf-7534-4967-9dc8-6c43093fcca6","type":"text/plain","content":"Entendido. 😊\n\nEstou checando a disponibilidade do nosso time de atendimento.\n\n{{n1}}Por favor, aguarde um minutinho ...{{n2}} ⌛","metadata":{}},"$cardContent":{"document":{"id":"e94cd9bf-7534-4967-9dc8-6c43093fcca6","type":"text/plain","content":"Entendido. 😊\n\nEstou checando a disponibilidade do nosso time de atendimento.\n\n{{n1}}Por favor, aguarde um minutinho ...{{n2}} ⌛"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1a137ba5-73f1-41e1-a456-82199fc73e94","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b781af4c-5f08-42f0-98b9-2365d8c0299f","type":"text/plain","content":"Feriado: {{feriado}}","metadata":{}},"$cardContent":{"document":{"id":"b781af4c-5f08-42f0-98b9-2365d8c0299f","type":"text/plain","content":"Feriado: {{feriado}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"41985a69-6ec8-4ad2-aaa6-bc1f10228e4e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"23ca06ed-322d-4dc9-9961-a901e0de5dbc","type":"text/plain","content":"validaRegraAtendimento: {{validaRegraAtendimento}}","metadata":{}},"$cardContent":{"document":{"id":"23ca06ed-322d-4dc9-9961-a901e0de5dbc","type":"text/plain","content":"validaRegraAtendimento: {{validaRegraAtendimento}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8e7abf23-ec80-42bf-9c91-e27198106abc","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0535a802-d5c0-4a58-b0d9-8bda40f72453","typeOfStateId":"state","$connId":"con_63","$id":"cf2e37cb-0eb4-4f63-985c-e22493d567b0","conditions":[{"source":"context","comparison":"contains","values":["ERROR"],"variable":"validaRegraAtendimento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"56ae23b4-e4e5-4438-80fe-c77c6109b8fd","$typeOfContent":"","type":"TrackEvent","$title":"transbordo exibicao","$invalid":false,"settings":{"extras":{},"category":"transbordo exibicao","action":"Exibicao"},"conditions":[]},{"$id":"4544a964-74da-43a1-b74c-baa309b583c0","$typeOfContent":"","type":"ExecuteScript","$title":"Feriado","$invalid":false,"settings":{"function":"run","source":"function run(holiday) {\n  try {\n    let holidayJS = JSON.parse(holiday);\n    let date = `${new Date().getMonth() + 1}-${new Date().getDate()}`;\n\n    for (let i = 0; i < holidayJS.length; i++) {\n      if (holidayJS[i] == date) {\n\n        return true\n      }\n    }\n    return false\n  }\n  catch (e) {\n    return 'ERROR: SCRIPT FAILURE'\n  }\n}","inputVariables":["resource.holiday"],"outputVariable":"feriado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2e103f9d-deec-49aa-beef-835a7ae3879e","$typeOfContent":"","type":"ExecuteScript","$title":"Valida Regra de Atendimento","$invalid":false,"settings":{"function":"run","source":"function run(regraAtendimento, RegrasDeAtendimento) {\n    try {        \n        RegrasDeAtendimento = JSON.parse(RegrasDeAtendimento)\n        const regras_config = RegrasDeAtendimento.regras\n\n        defineFila = (regraAtendimento) => {\n            const fila_config = {\n                \"0\": regras_config[0],\n                \"1\": regras_config[1],\n                \"2\": regras_config[2],\n                \"3\": regras_config[3],\n                \"4\": regras_config[4],\n                \"5\": regras_config[5],\n                \"6\": regras_config[6],\n                \"7\": regras_config[7],\n                \"8\": regras_config[8],\n                \"9\": regras_config[9],\n                \"10\": regras_config[10],\n                \"11\": regras_config[11],\n                \"12\": regras_config[12],\n                \n            }      \n            return fila_config[regraAtendimento] || 'ERROR: NO MATCH'\n        }\n\n        return JSON.stringify(defineFila(regraAtendimento))\n    }\n    catch (e) {\n        return 'ERROR: SCRIPT FAILURE'\n    }\n}","inputVariables":["regraAtendimento","resource.RegrasDeAtendimento"],"outputVariable":"validaRegraAtendimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3552a37-417e-4f5e-bd25-8d690b6e136c","$typeOfContent":"","type":"SetVariable","$title":"principal [Fila principal = true, backup = false]","$invalid":false,"settings":{"variable":"principal","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"41f7a447-b107-4cfd-ba6d-e1275c366cea","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-71cc8925-4712-543a-feb5-058475fd59db","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false},{"background":"#FF4A1E","label":"Set variable","id":"blip-tag-0b488f20-3494-a80c-e63c-d05d80fe4a4a","canChangeBackground":false}],"id":"eeeff199-2280-44bc-b0d4-46a0729ca89a","root":false,"$title":"[T.0.0.0]","$position":{"top":"257px","left":"386px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"41f7a447-b107-4cfd-ba6d-e1275c366cea":{"$contentActions":[{"action":{"$id":"38bd9c14-fc96-4a07-9d33-5c1ef761023a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"143c30a8-e3e6-4cc7-a277-daeacdaca36f","type":"text/plain","content":"principal: {{principal}}","metadata":{}},"$cardContent":{"document":{"id":"143c30a8-e3e6-4cc7-a277-daeacdaca36f","type":"text/plain","content":"principal: {{principal}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1f46a0c0-4086-4cff-8c38-62fdb80d6356","$typeOfContent":"text","type":"SendMessage","settings":{"id":"67ea7021-e8b4-40f7-99b1-c8d281bd6519","type":"text/plain","content":"now: {{now}}","metadata":{}},"$cardContent":{"document":{"id":"67ea7021-e8b4-40f7-99b1-c8d281bd6519","type":"text/plain","content":"now: {{now}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dccf0e93-0281-4816-9c39-dfcad338ff77","$typeOfContent":"text","type":"SendMessage","settings":{"id":"071b6a43-785d-4f0c-ab13-eeefe16e7bab","type":"text/plain","content":"workTime: {{workTime}}","metadata":{}},"$cardContent":{"document":{"id":"071b6a43-785d-4f0c-ab13-eeefe16e7bab","type":"text/plain","content":"workTime: {{workTime}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e645c104-4e61-493a-bbc4-40172e6fd54a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0b25393c-3fbd-4e59-bab0-aaa4888e5c9c","type":"text/plain","content":"validaWorkTime: {{validaWorkTime}}","metadata":{}},"$cardContent":{"document":{"id":"0b25393c-3fbd-4e59-bab0-aaa4888e5c9c","type":"text/plain","content":"validaWorkTime: {{validaWorkTime}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"89df7928-acc8-4985-baa1-fe908e78d86f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0535a802-d5c0-4a58-b0d9-8bda40f72453","typeOfStateId":"state","$connId":"con_68","$id":"4779e7c4-7cb5-41da-9e33-9f97d8b79b5b","conditions":[{"source":"context","comparison":"equals","values":["fora de hora"],"variable":"validaWorkTime"},{"source":"context","comparison":"equals","variable":"principal","values":["false"]}],"$invalid":false},{"stateId":"ba071c8a-375e-4120-92f0-beb9e4109f38","typeOfStateId":"state","$connId":"con_73","$id":"e0368bdb-3549-4f14-b8e7-24397a6a1b4e","conditions":[{"source":"context","comparison":"equals","values":["fora de hora"],"variable":"validaWorkTime"},{"source":"context","comparison":"equals","variable":"principal","values":["true"]}],"$invalid":false},{"stateId":"0535a802-d5c0-4a58-b0d9-8bda40f72453","typeOfStateId":"state","$connId":"con_78","$id":"9db8aa76-f91a-4531-9f63-ac74d9b48fbb","conditions":[{"source":"context","comparison":"contains","values":["ERROR"],"variable":"validaWorkTime"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8d6efe27-a8ba-4f71-89d0-e5c13a07edd9","$typeOfContent":"","type":"ExecuteScript","$title":"now","$invalid":false,"settings":{"function":"run","source":"// time format = 09:42 (09 horas e 42 minutos) GMT 0\n// Saída esperada: 06:42\nconst run = (time) => {    \n    \n    const config = {\n        hourOnly: false // Configura se o retorno vai ser somente a hora (Ex: 06) ou hora e minuto (Ex: 06:42) - Default: false (hora e minuto)\n    }    \n\n    let hour = time.split(':')[0]\n    hour = parseInt(hour)\n    let minute = time.split(':')[1]\n\n    switch (hour) {\n        case '0':\n        case '00':\n        case 0:\n        case 00:\n            hour = '21';\n            break;\n        case '1':\n        case '01':\n        case 1:\n        case 01:\n            hour = '22';\n            break;\n        case '2':\n        case '02':\n        case 2:\n        case 02:\n            hour = '23';\n            break;\n        default:\n            hour -= 3;\n            break;\n    }\n\n    if (config.hourOnly == true) {\n        return hour\n    } else {\n        return `${hour}:${minute}`\n    }\n}","inputVariables":["calendar.time"],"outputVariable":"now","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c1092a13-4e0e-4947-a985-92713e838697","$typeOfContent":"","type":"ExecuteScript","$title":"WorkTime Principal e Backup","$invalid":false,"settings":{"function":"run","source":"{{resource.WorkTime_CheckIn}}\n{{resource.WorkTime_Atendimento}}\n{{resource.WorkTime_Fila1}}\n{{resource.WorkTime_Fila2}}\n{{resource.WorkTime_InsideSales}}\n{{resource.WorkTime_Prorrogacao}}\n{{resource.WorkTime_RealocacaoReembolsoCancelamento}}\n{{resource.WorkTime_Reservas}}\n\n\nfunction run(validaRegraAtendimento) {\n    try {\n        validaRegraAtendimento = JSON.parse(validaRegraAtendimento)\n        let filaPrincipal = validaRegraAtendimento.filaPrincipal\n        let filaBackup = validaRegraAtendimento.filaBackup\n\n\n\n        //DEFINE QUAL RESOURCE SERÁ UTILIZADO\n        defineQualWorkTime = (fila) => {\n            const fila_config = {\n                \"Inside Sales\": insideSales(),\n                \"Fila 1\": fila1(),\n                \"Fila 2\": fila2(),\n                \"Prorrogação\": prorrogacao(),\n                \"Realocação/reembolso/cancelamento\": realocacaoReembolsoCancelamento(),\n                \"Check-In\": checkIn(),\n                \"Reservas\": reservas(),\n                \"Atendimento\": atendimento()\n\n            }\n            return fila_config[fila] || 'ERROR: NO MATCH'\n        }\n\n        \n        const workTime = {\n            principal: defineQualWorkTime(filaPrincipal),\n            backup: defineQualWorkTime(filaBackup)\n        }\n                \n        return workTime\n    }\n    catch (e) {\n        return 'ERROR: SCRIPT FAILURE'\n    }\n}","inputVariables":["validaRegraAtendimento"],"outputVariable":"workTime","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79d40a6a-6422-409c-a23f-c5a6bcd55c59","$typeOfContent":"","type":"ExecuteScript","$title":"valida WorkTime Principal e Backup","$invalid":false,"settings":{"function":"run","source":"/* ====================================\n    Valida workTime principal ou backup\n * ====================================\n    - principal: true ou false -> Se for true, valida horário da fila principal, se for false, valida horário da fila backup\n    - workTime: object -> Objeto com os horários das filas pincipais e backup\n    - now: string (Ex: 18:46) -> String que possui a hora atual, já convertida GMT -3\n */\nfunction run(principal, workTime, now) {\n    try {\n        let workTimeJS = JSON.parse(workTime)\n        if (principal == 'true') {\n            workTimeJS = workTimeJS.principal\n        } else {\n            workTimeJS = workTimeJS.backup\n        }       \n\n        /* weekdays (Dia da Semana)  \n         * Retorna um número invormando o dia da semana.\n         * 0 DOM, 1 SEG, 2 TER, 3 QUA, 4 QUI, 5 SEX, 6 SÁB     \n        */\n        let weekdays = new Date().getDay()\n\n        let time = now.replace(\":\", \"\")\n        time = parseInt(time)\n        \n        /* Valida se está dentro do horário */\n        let weekdaysId;\n        for (let i = 0; i < workTimeJS.weekdays.length; i++) {\n            weekdaysId = parseInt(workTimeJS.weekdays[i].id)\n            if (weekdaysId == weekdays) {\n                let hourStart = workTimeJS.weekdays[i].hourStart\n                let hourEnd = workTimeJS.weekdays[i].hourEnd\n\n                if (time < hourStart || time > hourEnd) {\n                    return `fora de hora`\n                }\n            }\n        }\n        return true\n    }\n    catch (e) {\n        return 'ERROR: SCRIPT FAILURE'\n    }\n}","inputVariables":["principal","workTime","now"],"outputVariable":"validaWorkTime","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"327d9a69-6be0-4146-aa8c-e25a3b8a35fb","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false}],"id":"41f7a447-b107-4cfd-ba6d-e1275c366cea","root":false,"$title":"Valida Horário da Fila","$position":{"top":"375px","left":"384px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0535a802-d5c0-4a58-b0d9-8bda40f72453":{"$contentActions":[{"action":{"$id":"aa2af8e0-9cab-47df-a5c7-d20b2eb7ff02","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"075247be-4fc8-4caf-9e41-e3da15df27fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"075247be-4fc8-4caf-9e41-e3da15df27fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0604190c-ce7e-4258-896d-3b1ac58bb765","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d2572835-704f-4fa8-b33b-fc531e4c0f79","type":"text/plain","content":"{{texto}}","metadata":{}},"$cardContent":{"document":{"id":"d2572835-704f-4fa8-b33b-fc531e4c0f79","type":"text/plain","content":"{{texto}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"282ecbbe-53e3-4bff-a134-8d226e89f781","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"42515ed1-b72c-472a-8d20-da87be5352f2","$typeOfContent":"","type":"ExecuteScript","$title":"texto","$invalid":false,"settings":{"function":"run","source":"function run(feriado, validaRegraAtendimento) {\n    validaRegraAtendimento = JSON.parse(validaRegraAtendimento)\n\n    if (feriado == 'true') {\n        return `Agradecemos o contato, {{n1}}hoje é feriado{{n2}}, e por conta disso, nosso expediente já se encerrou. 😕\\n\\n{{n1}}Nosso atendimento em feriados se encerra às 19h.{{n2}}`\n    } else {\n        let fila = validaRegraAtendimento.filaPrincipal;\n\n        if (fila == \"Fila 1\" || fila == \"Fila 2\" || fila == \"Check-In\") {\n            return `Nossa equipe não está disponível nesse momento. 😕\\n\\n{{n1}}Lembrando que nosso horário de atendimento é de:{{n2}}\\n\\n🕐 {{n1}}08h às 23h;{{n2}}\\n📅 {{n1}}Todos os dias da semana.{{n2}}`\n        } else if (fila == \"Inside Sales\" || fila == \"Prorrogação\") {\n            return `Nossa equipe não está disponível nesse momento. 😕\\n\\n{{n1}}Lembrando que nosso horário de atendimento é de:{{n2}}\\n\\n🕐 {{n1}}08h às 22h;{{n2}}\\n📅 {{n1}}Todos os dias da semana.{{n2}}`\n        } else {\n            return `Nossa equipe não está disponível nesse momento. 😕\\n\\nNosso horário de atendimento é de:\\n\\n{{n1}}Segunda à Sexta: 08h às 22h;{{n2}}\\n{{n1}}Finais de semana: 08h ás 14h{{n2}}`\n        }\n    }\n}","inputVariables":["feriado","validaRegraAtendimento"],"outputVariable":"texto","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d10eb02-329f-43f7-b8d0-a905da530164","$typeOfContent":"","type":"TrackEvent","$title":"fora horario exibicao","$invalid":false,"settings":{"extras":{},"category":"fora horario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ac224a32-3f42-4dc6-a99f-97882ac72b3c","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#61D36F","label":"Event tracking","id":"blip-tag-71cc8925-4712-543a-feb5-058475fd59db","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false}],"id":"0535a802-d5c0-4a58-b0d9-8bda40f72453","root":false,"$title":"Fora de horário de Atendimento","$position":{"top":"355px","left":"118.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"327d9a69-6be0-4146-aa8c-e25a3b8a35fb":{"$contentActions":[{"action":{"$id":"3913b485-d95c-4dee-a96e-a9a869f52010","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8aec2cfe-999c-46ac-8e6f-62f0edf8ea20","type":"text/plain","content":"{{statusOnlineAgents}} - {{responseOnlineAgents}}","metadata":{}},"$cardContent":{"document":{"id":"8aec2cfe-999c-46ac-8e6f-62f0edf8ea20","type":"text/plain","content":"{{statusOnlineAgents}} - {{responseOnlineAgents}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"deff9aad-4b07-439d-bc28-aa634875da64","$typeOfContent":"text","type":"SendMessage","settings":{"id":"80ce6517-9e81-440c-8404-58c5fb4f855a","type":"text/plain","content":"validaOnlineAgents: {{validaOnlineAgents}}","metadata":{}},"$cardContent":{"document":{"id":"80ce6517-9e81-440c-8404-58c5fb4f855a","type":"text/plain","content":"validaOnlineAgents: {{validaOnlineAgents}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0c0b1d50-3df4-472d-bb71-f89dc4e3266f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0535a802-d5c0-4a58-b0d9-8bda40f72453","typeOfStateId":"state","$connId":"con_83","$id":"a7368399-5760-43cf-a959-e2d947f748a7","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusOnlineAgents"}],"$invalid":false},{"stateId":"ea06abe0-0319-4662-853c-eadc7c1bb94a","typeOfStateId":"state","$connId":"con_88","$id":"ff033208-6b22-4ac9-96f9-3dfe1a3548ca","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"validaOnlineAgents"}],"$invalid":false},{"stateId":"ba071c8a-375e-4120-92f0-beb9e4109f38","typeOfStateId":"state","$connId":"con_93","$id":"d931735d-18c3-49b0-9529-d4763d22986d","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"validaOnlineAgents"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e45101dc-5720-49f5-9b93-1e346df0bf7c","$typeOfContent":"","type":"ProcessHttp","$title":"GET Online Agents","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{\n  \"id\": \"{{$guid}}\",\n  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/teams/agents-online\"\n}","uri":"{{config.urlBlip}}","responseStatusVariable":"statusOnlineAgents","responseBodyVariable":"responseOnlineAgents"},"conditions":[]},{"$id":"a3b80cef-7a8c-40a6-89d6-efc487995281","$typeOfContent":"","type":"ExecuteScript","$title":"Valida Agentes Online por Fila","$invalid":false,"settings":{"function":"run","source":"/* Valida atendentes online por fila */\nfunction run(responseOnlineAgents, principal, validaRegraAtendimento) {\n    responseOnlineAgents = JSON.parse(responseOnlineAgents)\n    const listaFilas = responseOnlineAgents.resource.items\n    validaRegraAtendimento = JSON.parse(validaRegraAtendimento)\n    let fila;\n    if (principal == 'true') {\n        fila = validaRegraAtendimento.filaPrincipal\n    } else {\n        fila = validaRegraAtendimento.filaBackup\n    }\n\n    let agentsOnline;\n    for (let i = 0; i < listaFilas.length; i++) {\n\n        if (listaFilas[i].name == fila) {\n            agentsOnline = listaFilas[i].agentsOnline\n            break;\n        }\n    }\n    \n    if (agentsOnline > 0) {\n        return true\n    }\n    return false\n}","inputVariables":["responseOnlineAgents","principal","validaRegraAtendimento"],"outputVariable":"validaOnlineAgents","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusOnlineAgents","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false}],"id":"327d9a69-6be0-4146-aa8c-e25a3b8a35fb","root":false,"$title":"Valida Disponibilidade Atendente","$position":{"top":"493px","left":"385px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#f06292","textColor":"#000000"}},"ea06abe0-0319-4662-853c-eadc7c1bb94a":{"$contentActions":[{"action":{"$id":"737a138a-654f-47c4-a2b9-e934ec6cf009","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19412a8b-f30c-4ab7-be26-c9880ba9eac4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19412a8b-f30c-4ab7-be26-c9880ba9eac4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"32e2b021-8448-42b7-b20e-62638b72e823","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8658c593-3539-4a78-a06c-dab749ab4bad","type":"text/plain","content":"Obrigado por esperar! 😊\n\n{{n1}}Está tudo pronto para iniciarmos o seu atendimento.{{n2}}","metadata":{}},"$cardContent":{"document":{"id":"8658c593-3539-4a78-a06c-dab749ab4bad","type":"text/plain","content":"Obrigado por esperar! 😊\n\n{{n1}}Está tudo pronto para iniciarmos o seu atendimento.{{n2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d06337cb-f30d-4737-8cef-847341f76875","$typeOfContent":"text","type":"SendMessage","settings":{"id":"97cb53a4-e88a-4dd8-aacb-8558f613907e","type":"text/plain","content":"principal: {{principal}}","metadata":{}},"$cardContent":{"document":{"id":"97cb53a4-e88a-4dd8-aacb-8558f613907e","type":"text/plain","content":"principal: {{principal}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"bb9e8642-9a47-44a1-a1ec-5642c30e4aaf","$typeOfContent":"text","type":"SendMessage","settings":{"id":"786a43b1-2549-43c6-9b36-6190052dd202","type":"text/plain","content":"contact.extras.Fila: {{contact.extras.Fila}}","metadata":{}},"$cardContent":{"document":{"id":"786a43b1-2549-43c6-9b36-6190052dd202","type":"text/plain","content":"contact.extras.Fila: {{contact.extras.Fila}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a48bc93-98d8-48a3-b1ea-cec4ef2b8c3f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","typeOfStateId":"state","$connId":"con_98","$id":"2179e704-be30-40c7-b5a2-b2ffd75ee1bb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a6b8cf2a-77fe-4dbc-b903-81282f0db1dc","$typeOfContent":"","type":"TrackEvent","$title":"inicio atendimento exibicao","$invalid":false,"settings":{"extras":{},"category":"inicio atendimento exibicao","action":"Exibicao"},"conditions":[]},{"$id":"ac8c43d4-b50a-4bc1-91e9-e39c0cc78df0","$typeOfContent":"","type":"MergeContact","$title":"Fila Principal","$invalid":false,"settings":{"extras":{"Fila":"{{validaRegraAtendimento@filaPrincipal}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"principal","values":["true"]}]},{"$id":"f42a5520-3b69-476a-b7cc-990ba760e467","$typeOfContent":"","type":"MergeContact","$title":"Fila Backup","$invalid":false,"settings":{"extras":{"Fila":"{{validaRegraAtendimento@filaBackup}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"principal","values":["false"]}]},{"$id":"51f306e0-108f-4ef0-9dbb-89296763a8a0","$typeOfContent":"","type":"ProcessCommand","$title":"Merge das Informações extras","$invalid":false,"settings":{"to":"postmaster@msging.net","method":"merge","resource":"{\"identity\":\"{{tunnel.identity}}\",\"source\":\"{{contact.source}}\",\"extras\":{\"Fila\":\"{{contact.extras.Fila}}\"}}","type":"application/vnd.lime.contact","uri":"/contacts","variable":"statusMergeContact"},"conditions":[]},{"$id":"d2e44593-5b4e-410c-ae3c-8d320e65cef7","$typeOfContent":"","type":"ExecuteScript","$title":"bodyExtrasJs","$invalid":false,"settings":{"function":"run","source":"function run(contact, id){\n    obj = JSON.parse(contact)\n    obj.identity = id\n\n    request = {\n        \"id\": \"{{$guid}}\",\n        \"method\": \"set\",\n        \"uri\": \"/contacts\",\n        \"type\": \"application/vnd.lime.contact+json\",\n        \"resource\": obj\n    }\n    return request\n}","inputVariables":["contact.serialized","tunnel.identity"],"outputVariable":"bodyExtrasJs","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"22e1750a-d953-454d-b03c-8f47c881e711","$typeOfContent":"","type":"ProcessHttp","$title":"updateExtras","$invalid":false,"settings":{"headers":{"Authorization":"{{config.token}}","Content-Type":"application/json"},"method":"POST","body":"{{bodyExtrasJs}}","uri":"{{config.urlBlip}}","responseStatusVariable":"statusUpdateExtras","responseBodyVariable":"responseUpdateExtras"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false},{"background":"#7762E3","label":"Set Contact","id":"blip-tag-6e13007c-716c-6d50-68aa-0efb8b4afb47","canChangeBackground":false},{"background":"#61D36F","label":"Event tracking","id":"blip-tag-71cc8925-4712-543a-feb5-058475fd59db","canChangeBackground":false},{"background":"#FF1E90","label":"HTTP Request","id":"blip-tag-5673e590-3e8b-161c-883c-12340bcae7d5","canChangeBackground":false}],"id":"ea06abe0-0319-4662-853c-eadc7c1bb94a","root":false,"$title":"[T.0.0.2] Agente Online","$position":{"top":"718px","left":"385px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba071c8a-375e-4120-92f0-beb9e4109f38":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"27aca580-7681-4f7b-a6f1-de688597455e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0224162-608b-4ab7-8e46-c6bcde246a63","typeOfStateId":"state","$connId":"con_103","$id":"bae45f35-335f-4928-92af-e6878747f761","conditions":[{"source":"context","comparison":"contains","values":["ERROR"],"variable":"principal"}],"$invalid":false},{"stateId":"41f7a447-b107-4cfd-ba6d-e1275c366cea","typeOfStateId":"state","$connId":"con_108","$id":"e976e5e2-bf3b-479f-8869-f6170882e63a","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"principal"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"315d8ad4-b375-4463-8709-5e8ce5aef3dc","$typeOfContent":"","type":"ExecuteScript","$title":"Checa Principal","$invalid":false,"settings":{"function":"run","source":"function run(principal) {\n    if (principal == 'true') {\n        return false\n    } else {\n        return 'ERROR: SEM AGENTES ONLINE NA FILA PRINCIPAL NEM BACKUP'\n    }\n    \n}","inputVariables":["principal"],"outputVariable":"principal","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-d2974ed4-d8d9-0d87-6153-fbed3205d146","canChangeBackground":false}],"id":"ba071c8a-375e-4120-92f0-beb9e4109f38","root":false,"$title":"Valida Fila Backup","$position":{"top":"440px","left":"636px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0224162-608b-4ab7-8e46-c6bcde246a63":{"$contentActions":[{"action":{"$id":"62fc8dbb-371b-4af2-918d-3a17222702d3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"75815d7a-b5eb-46ee-b006-b911e2f26c0e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"75815d7a-b5eb-46ee-b006-b911e2f26c0e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"bf4d5c2a-2ee1-41b5-968a-8f4c5c03dced","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2bd1e20a-bcc2-4b2f-9d79-b7f9278f4eba","type":"text/plain","content":" No momento, todos os nossos atendentes estão ocupados. \n\nNão se preocupe, te coloquei na nossa {{n1}}fila de atendimento{{n2}} e em breve você será atendido... ⏳","metadata":{}},"$cardContent":{"document":{"id":"2bd1e20a-bcc2-4b2f-9d79-b7f9278f4eba","type":"text/plain","content":" No momento, todos os nossos atendentes estão ocupados. \n\nNão se preocupe, te coloquei na nossa {{n1}}fila de atendimento{{n2}} e em breve você será atendido... ⏳"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e30c1957-c965-498d-b7a6-e1128ecf0e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","typeOfStateId":"state","$connId":"con_113","$id":"cf6ab9b5-128c-4bba-83c0-236306155a34","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"f0224162-608b-4ab7-8e46-c6bcde246a63","root":false,"$title":"[T.0.0.4] Ir para Fila de Atendimento","$position":{"top":"762.714px","left":"635.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac224a32-3f42-4dc6-a99f-97882ac72b3c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"581d2ca6-5ab2-4e38-8726-d22b30bcf23c","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8735939c-ee24-45e9-ba72-24fe28e39c0d","$typeOfContent":"","type":"Redirect","$title":"[GO TO] Algo Mais","$invalid":false,"settings":{"context":{"type":"text/plain","value":"ola"},"address":"{{serviceList@algo_mais}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"REDIRECT TO","id":"blip-tag-82243cbc-e3cc-2e9d-4799-05fe802b8731","canChangeBackground":false}],"id":"ac224a32-3f42-4dc6-a99f-97882ac72b3c","root":false,"$title":"[REDIRECT TO] Algo Mais","$position":{"top":"391.857px","left":"1605.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#c8e6c9","textColor":"#000000","commentsIdList":[]}}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}